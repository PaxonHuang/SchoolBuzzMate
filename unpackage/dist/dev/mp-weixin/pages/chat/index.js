"use strict";const e=require("../../common/vendor.js"),t=require("../../stores/user.js");Math||a();const a=()=>"../../components/brutalist/BrutalistCard.js",n=e.defineComponent({__name:"index",setup(a){const n=t.useUserStore(),r=e.ref([]),s=e.ref(""),o=e.ref(""),i=e.ref(null);e.onMounted((async()=>{if(!n.isLoggedIn)return e.index.showToast({title:"请先登录",icon:"none"}),void e.index.navigateTo({url:"/pages/index/index"});o.value=n.user._id;const t=e.tr.database().collection("messages");i.value=t.where(`receiver == '${o.value}' || sender == '${o.value}'`).orderBy("timestamp","asc").watch({onChange:e=>{r.value=e.data},onError:t=>{e.index.__f__("error","at pages/chat/index.vue:81","消息监听失败:",t)}})})),e.onUnmounted((()=>{i.value&&(i.value.close(),i.value=null)}));const u=e=>{const t=new Date(e);return`${t.getHours()}:${t.getMinutes().toString().padStart(2,"0")}`},c=async()=>{if(s.value.trim())try{const t=e.tr.database();await t.collection("messages").add({content:s.value.trim(),sender:o.value,receiver:"admin",timestamp:Date.now(),read:!1}),s.value=""}catch(t){e.index.__f__("error","at pages/chat/index.vue:115","发送失败:",t),e.index.showToast({title:"发送失败",icon:"none"})}};return(t,a)=>({a:e.f(r.value,((t,a,n)=>({a:e.t(t.content),b:e.t(u(t.timestamp)),c:t.sender===o.value?1:"",d:"5a559478-1-"+n+",5a559478-0",e:a,f:t.sender===o.value?1:""}))),b:e.o(c),c:s.value,d:e.o((e=>s.value=e.detail.value)),e:e.o(c),f:e.p({accent:!0})})}}),r=e._export_sfc(n,[["__scopeId","data-v-5a559478"]]);wx.createPage(r);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/chat/index.js.map
