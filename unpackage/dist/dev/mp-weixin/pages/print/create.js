"use strict";const e=require("../../common/vendor.js"),t=require("../../stores/user.js");Math||a();const a=()=>"../../components/brutalist/BrutalistCard.js",l=e.defineComponent({__name:"create",setup(a){const l=t.useUserStore(),o=e.ref(null),i=e.ref(null),n=["图书馆一楼打印店","学生活动中心B座打印点","东门校外打印店（5分钟）","西门快印中心"],s=[{label:"黑白 单面",value:"mono-single"},{label:"黑白 双面",value:"mono-double"},{label:"彩色 单面",value:"color-single"},{label:"彩色 双面",value:"color-double"}],u=e.ref({printOption:"mono-single",copies:1}),r=e.computed((()=>{const e=u.value.printOption.startsWith("color")?.8:.3,t=u.value.printOption.endsWith("double")?.9:1;return(e*u.value.copies*t).toFixed(1)})),c=()=>{e.index.chooseFile({count:1,type:"file",success:e=>{e.tempFiles&&e.tempFiles.length>0&&(o.value=e.tempFiles[0])}})},p=e=>{i.value=e.detail.value},v=()=>{u.value.copies<100&&u.value.copies++},d=()=>{u.value.copies>1&&u.value.copies--},m=async()=>{if(l.isLoggedIn)if(o.value)if(null!==i.value)try{const t=await e.tr.uploadFile({filePath:o.value.tempFilePath,cloudPath:`prints/${Date.now()}_${o.value.name}`}),a=e.tr.database(),{user:s}=l,c=parseFloat(r.value),{_id:p}=await a.collection("requests").add({type:"print",title:`打印任务 - ${o.value.name}`,description:`${o.value.name} x ${u.value.copies}份`,tags:[u.value.printOption],createTime:Date.now(),creator:s._id,status:"unpaid",print:{fileId:t.fileID,shop:n[i.value],option:u.value.printOption,copies:u.value.copies}});await a.collection("orders").add({requestId:p,amount:c,status:"unpaid",createTime:Date.now()}),e.index.navigateTo({url:`/pages/payment/index?orderId=${p}&amount=${c}`})}catch(t){e.index.__f__("error","at pages/print/create.vue:187","提交失败:",t),e.index.showToast({title:"提交失败",icon:"none"})}else e.index.showToast({title:"请选择打印店",icon:"none"});else e.index.showToast({title:"请上传文件",icon:"none"});else e.index.showToast({title:"请先登录",icon:"none"})};return(t,a)=>({a:e.t(o.value?o.value.name:"点击上传文档"),b:e.o(c),c:e.t(null!==i.value?n[i.value]:"请选择打印店"),d:n,e:i.value,f:e.o(p),g:e.f(s,((t,a,l)=>({a:e.t(t.label),b:t.value,c:u.value.printOption===t.value?1:"",d:e.o((e=>u.value.printOption=t.value),t.value)}))),h:e.o(d),i:e.t(u.value.copies),j:e.o(v),k:e.t(r.value),l:e.o(m),m:e.p({accent:!0})})}}),o=e._export_sfc(l,[["__scopeId","data-v-e31aa6ff"]]);wx.createPage(o);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/print/create.js.map
