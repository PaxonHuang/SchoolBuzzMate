"use strict";const e=require("../../common/vendor.js"),t=require("../../stores/user.js");Math||(a+n)();const a=()=>"../../components/brutalist/BrutalistCard.js",n=()=>"../../components/brutalist/TabBar.js",o=e.defineComponent({__name:"index",setup(a){const n=t.useUserStore(),o=e.ref([]),r=e.ref("all"),l=[{label:"å…¨éƒ¨",value:"all",emoji:"ğŸ“‹"},{label:"è®¢å•",value:"order",emoji:"ğŸ“¦"},{label:"è¯„è®º",value:"comment",emoji:"ğŸ’¬"},{label:"ç‚¹èµ",value:"like",emoji:"â¤ï¸"},{label:"ç§ä¿¡",value:"chat",emoji:"âœ‰ï¸"},{label:"ç³»ç»Ÿ",value:"system",emoji:"ğŸ””"}],i=e.computed((()=>"all"===r.value?o.value:o.value.filter((e=>e.type===r.value))));function s(e){return"all"===e?o.value.filter((e=>!e.read)).length:o.value.filter((t=>!t.read&&t.type===e)).length}function u(){const e=l.find((e=>e.value===r.value));return(null==e?void 0:e.label)||""}function d(e){return{order:"è®¢å•é€šçŸ¥",comment:"æ–°è¯„è®º",like:"ç‚¹èµæé†’",system:"ç³»ç»Ÿæ¶ˆæ¯",chat:"ç§ä¿¡æ¶ˆæ¯"}[e]||"æ–°æ¶ˆæ¯"}function c(e){const t=new Date(e),a=(new Date).getTime()-t.getTime();if(a<6e4)return"åˆšåˆš";if(a<36e5)return Math.floor(a/6e4)+"åˆ†é’Ÿå‰";if(a<864e5)return Math.floor(a/36e5)+"å°æ—¶å‰";if(a<6048e5)return Math.floor(a/864e5)+"å¤©å‰";return t.getMonth()+1+"æœˆ"+t.getDate()+"æ—¥"}async function m(){var t;try{const a=e.tr.database(),r=(null==(t=n.user)?void 0:t._id)||"",l=await a.collection("messages").where(`receiver == '${r}' || sender == '${r}'`).orderBy("timestamp desc","desc").limit(50).get();o.value=l.data.map((e=>({...e,timestamp:e.timestamp||Date.now()})))}catch(a){e.index.__f__("error","at pages/messages/index.vue:205","åŠ è½½æ¶ˆæ¯å¤±è´¥:",a);const t=e.index.getStorageSync("messages")||[];t.length>0?o.value=t.map((e=>({...e,timestamp:e.timestamp||Date.now()}))):o.value=[{_id:"1",type:"order",title:"è®¢å•å·²æ¥å•",content:"æ‚¨çš„è·‘è…¿è®¢å•å·²è¢«äººæ¥å•ï¼Œè¯·ä¿æŒè”ç³»",timestamp:Date.now()-18e5,read:!1,orderInfo:"ä»»åŠ¡ï¼šå¸®å¿™å–ä¸ªå¿«é€’\næ¥å•äººï¼šå°ç‹\nè´¹ç”¨ï¼šÂ¥5"},{_id:"2",type:"comment",title:"æ–°è¯„è®º",content:'ç”¨æˆ·"å­¦ä¹ è¾¾äºº"è¯„è®ºäº†ä½ çš„å¸–å­',timestamp:Date.now()-72e5,read:!0},{_id:"3",type:"like",title:"æ”¶åˆ°ç‚¹èµ",content:'ä½ çš„å¸–å­"å›¾ä¹¦é¦†çº¦å­¦ä¹ æ­å­"è·å¾—äº†æ–°ç‚¹èµ',timestamp:Date.now()-144e5,read:!1},{_id:"4",type:"system",title:"ç³»ç»Ÿé€šçŸ¥",content:"æ¬¢è¿ä½¿ç”¨æ ¡è¶£é—ªæ­ï¼è¿™é‡Œæ˜¯ä½ çš„æ ¡å›­ç”Ÿæ´»æœåŠ¡å¹³å°",timestamp:Date.now()-288e5,read:!0},{_id:"5",type:"chat",title:"ç§ä¿¡æ¶ˆæ¯",content:"ç¾é£Ÿæ¢ç´¢å®¶ï¼šé‚£å®¶éº»è¾£çƒ«ç¡®å®ä¸é”™ï¼",timestamp:Date.now()-432e5,read:!1}],f()}}function f(){e.index.setStorageSync("messages",o.value)}return m(),e.onPullDownRefresh((async()=>{await m(),e.index.stopPullDownRefresh()})),(t,a)=>e.e({a:e.p({taped:!0,accent:!0}),b:e.f(l,((t,a,n)=>e.e({a:e.t(t.emoji),b:e.t(t.label),c:s(t.value)>0},s(t.value)>0?{d:e.t(s(t.value))}:{},{e:t.value,f:r.value===t.value?1:"",g:e.o((e=>function(e){r.value=e}(t.value)),t.value)}))),c:e.f(i.value,((t,a,n)=>{return e.e({a:e.t((o=t.type,{order:"ğŸ“¦",comment:"ğŸ’¬",like:"â¤ï¸",system:"ğŸ””",chat:"âœ‰ï¸"}[o]||"ğŸ””")),b:e.n("message-icon-"+t.type),c:e.t(t.title||d(t.type)),d:e.t(c(t.timestamp)),e:e.t(t.content),f:t.orderInfo},t.orderInfo?{g:e.t(t.orderInfo)}:{},{h:!t.read},(t.read,{}),{i:t._id,j:t.read?"":1,k:e.o((a=>function(t){t.read||(t.read=!0,f()),"order"===t.type&&t.orderInfo?e.index.showModal({title:"è®¢å•è¯¦æƒ…",content:t.orderInfo,showCancel:!1}):e.index.showModal({title:t.title||d(t.type),content:t.content,showCancel:!1})}(t)),t._id)});var o})),d:0===i.value.length},0===i.value.length?{e:e.t(u()),f:e.p({dashed:!0})}:{})}}),r=e._export_sfc(o,[["__scopeId","data-v-aedce2fc"]]);wx.createPage(r);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/messages/index.js.map
