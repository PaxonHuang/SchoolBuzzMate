"use strict";const e=require("../../common/vendor.js"),n=require("../../stores/user.js");Math||(t+o+s)();const t=()=>"../../components/brutalist/BrutalistCard.js",o=()=>"../../components/brutalist/BrutalistButton.js",s=()=>"../../components/brutalist/TabBar.js",i=e.defineComponent({__name:"index",setup(t){const o=n.useUserStore();function s(n){e.index.switchTab({url:`/pages/${n}/index`})}async function i(){try{e.index.showLoading({title:"登录中..."});const n=await e.index.login({provider:"weixin"});e.index.hideLoading();let t="";if(Array.isArray(n)){const e=n[1]||n[0];t=(null==e?void 0:e.code)||""}else n&&"object"==typeof n&&(t=n.code||"");t||(e.index.__f__("log","at pages/index/index.vue:160","uni.login 返回值:",JSON.stringify(n)),t="mock_code_"+Date.now());const s=await o.login(t);s.success?e.index.showToast({title:s.message||"登录成功",icon:"success"}):e.index.showToast({title:s.message||"登录失败",icon:"none"})}catch(n){e.index.hideLoading(),e.index.__f__("error","at pages/index/index.vue:181","登录错误:",n);(await o.login("fallback_code_"+Date.now())).success?e.index.showToast({title:"登录成功（离线模式）",icon:"success"}):e.index.showToast({title:"登录失败，请重试",icon:"none"})}}async function a(){try{(await e.index.showModal({title:"提示",content:"确定要退出登录吗？"})).confirm&&(await o.logout(),e.index.showToast({title:"已退出登录",icon:"success"}))}catch(n){e.index.__f__("error","at pages/index/index.vue:214","退出登录错误:",n)}}return e.onMounted((()=>{o.checkLoginStatus()})),(n,t)=>{var r,d,u,c,l,g;return e.e({a:e.p({taped:!0,accent:!0,doodle:!0}),b:!e.unref(o).isLoggedIn},e.unref(o).isLoggedIn?e.e({f:e.t((null==(d=null==(r=e.unref(o).user)?void 0:r.nickname)?void 0:d.charAt(0))||"U"),g:e.t((null==(u=e.unref(o).user)?void 0:u.nickname)||"校园用户"),h:e.t((null==(c=e.unref(o).user)?void 0:c.campus)||"未设置校区"),i:e.o(a),j:e.p({outline:!0}),k:(null==(l=e.unref(o).user)?void 0:l.tags)&&e.unref(o).user.tags.length>0},(null==(g=e.unref(o).user)?void 0:g.tags)&&e.unref(o).user.tags.length>0?{l:e.f(e.unref(o).user.tags,((n,t,o)=>({a:e.t(n),b:t})))}:{},{m:e.o((e=>s("buddy"))),n:e.o((e=>s("delivery"))),o:e.o((e=>s("forum"))),p:e.p({taped:!0})}):{c:e.o(i),d:e.p({accent:!0,taped:!0,arrow:!0,large:!0}),e:e.p({dashed:!0})},{q:e.unref(o).isLoggedIn},e.unref(o).isLoggedIn?{r:e.p({dashed:!0})}:{})}}}),a=e._export_sfc(i,[["__scopeId","data-v-1cf27b2a"]]);wx.createPage(a);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/index/index.js.map
