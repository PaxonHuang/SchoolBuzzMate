"use strict";const e=require("../../common/vendor.js"),t=require("../../stores/user.js");Math||(n+o+a)();const n=()=>"../../components/brutalist/BrutalistCard.js",o=()=>"../../components/brutalist/BrutalistButton.js",a=()=>"../../components/brutalist/TabBar.js",i=e.defineComponent({__name:"index",setup(n){const o=t.useUserStore(),a=e.ref([]),i=e.computed((()=>a.value.filter((e=>!e.read)).length));function s(t){e.index.switchTab({url:`/pages/${t}/index`})}function r(){e.index.navigateTo({url:"/pages/user/index"})}function d(){e.index.switchTab({url:"/pages/messages/index"})}function c(e){return{order:"è®¢å•é€šçŸ¥",comment:"æ–°è¯„è®º",like:"ç‚¹èµæé†’",system:"ç³»ç»Ÿæ¶ˆæ¯",chat:"ç§ä¿¡æ¶ˆæ¯"}[e]||"æ–°æ¶ˆæ¯"}function u(e){const t=new Date(e),n=(new Date).getTime()-t.getTime();return n<6e4?"åˆšåˆš":n<36e5?Math.floor(n/6e4)+"åˆ†é’Ÿå‰":n<864e5?Math.floor(n/36e5)+"å°æ—¶å‰":Math.floor(n/864e5)+"å¤©å‰"}async function l(){try{const t=e.tr.database(),n=await t.collection("messages").where("receiver == $env.UNI_USER_ID || sender == $env.UNI_USER_ID").orderBy("timestamp","desc").limit(20).get();a.value=n.data}catch(t){e.index.__f__("error","at pages/index/index.vue:267","åŠ è½½æ¶ˆæ¯å¤±è´¥:",t),a.value=[{_id:"1",type:"order",title:"è®¢å•é€šçŸ¥",content:"æ‚¨çš„è·‘è…¿è®¢å•å·²æ¥å•",timestamp:Date.now(),read:!1},{_id:"2",type:"comment",title:"æ–°è¯„è®º",content:"ç”¨æˆ·Aè¯„è®ºäº†æ‚¨çš„å¸–å­",timestamp:Date.now()-36e5,read:!1}]}}async function g(){try{e.index.showLoading({title:"ç™»å½•ä¸­..."});const t=await e.index.login({provider:"weixin"});e.index.hideLoading();let n="";if(Array.isArray(t)){const e=t[1]||t[0];n=(null==e?void 0:e.code)||""}else t&&"object"==typeof t&&(n=t.code||"");n||(e.index.__f__("log","at pages/index/index.vue:313","uni.login è¿”å›å€¼:",JSON.stringify(t)),n="mock_code_"+Date.now());const a=await o.login(n);a.success?e.index.showToast({title:a.message||"ç™»å½•æˆåŠŸ",icon:"success"}):e.index.showToast({title:a.message||"ç™»å½•å¤±è´¥",icon:"none"})}catch(t){e.index.hideLoading(),e.index.__f__("error","at pages/index/index.vue:334","ç™»å½•é”™è¯¯:",t);(await o.login("fallback_code_"+Date.now())).success?e.index.showToast({title:"ç™»å½•æˆåŠŸï¼ˆç¦»çº¿æ¨¡å¼ï¼‰",icon:"success"}):e.index.showToast({title:"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•",icon:"none"})}}return e.onMounted((()=>{o.checkLoginStatus(),o.isLoggedIn&&l()})),e.onShow((()=>{o.isLoggedIn&&l()})),(t,n)=>{var l,m,p,f,v,h,_,x;return e.e({a:e.p({taped:!0,accent:!0,doodle:!0}),b:!e.unref(o).isLoggedIn},e.unref(o).isLoggedIn?e.e({f:e.t((null==(m=null==(l=e.unref(o).user)?void 0:l.nickname)?void 0:m.charAt(0))||"U"),g:e.o(r),h:e.t((null==(p=e.unref(o).user)?void 0:p.nickname)||"æ ¡å›­ç”¨æˆ·"),i:e.t((null==(f=e.unref(o).user)?void 0:f.campus)||"æœªè®¾ç½®æ ¡åŒº"),j:e.o(r),k:e.p({accent:!0,taped:!0}),l:(null==(h=null==(v=e.unref(o).user)?void 0:v.tags)?void 0:h.length)>0},(null==(x=null==(_=e.unref(o).user)?void 0:_.tags)?void 0:x.length)>0?{m:e.f(e.unref(o).user.tags,((t,n,o)=>({a:e.t(t),b:n})))}:{},{n:e.o((e=>s("buddy"))),o:e.o((e=>s("delivery"))),p:e.o((e=>s("forum"))),q:e.p({taped:!0})}):{c:e.o(g),d:e.p({accent:!0,taped:!0,arrow:!0,large:!0}),e:e.p({dashed:!0})},{r:i.value>0},i.value>0?{s:e.t(i.value)}:{},{t:a.value.length>0},a.value.length>0?{v:e.f(a.value.slice(0,3),((t,n,o)=>{return{a:e.t((a=t.type,{order:"ğŸ“¦",comment:"ğŸ’¬",like:"â¤ï¸",system:"ğŸ””",chat:"ğŸ’¬"}[a]||"ğŸ””")),b:e.n("message-icon-"+t.type),c:e.t(t.title||c(t.type)),d:e.t(t.content),e:e.t(u(t.timestamp||t.createTime)),f:t._id||n,g:e.o((n=>function(t){e.index.navigateTo({url:`/pages/messages/index?messageId=${t._id}`})}(t)),t._id||n)};var a}))}:{},{w:a.value.length>0},a.value.length>0?{x:e.o(d),y:e.p({outline:!0})}:{},{z:e.p({dashed:!0})})}}}),s=e._export_sfc(i,[["__scopeId","data-v-1cf27b2a"]]);wx.createPage(s);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/index/index.js.map
