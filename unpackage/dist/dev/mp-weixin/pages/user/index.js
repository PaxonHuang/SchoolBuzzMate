"use strict";const e=require("../../common/vendor.js"),a=require("../../stores/user.js");if(!Array){e.resolveComponent("uni-popup")()}Math||(t+n+o)();const t=()=>"../../components/brutalist/BrutalistCard.js",n=()=>"../../components/brutalist/BrutalistButton.js",o=()=>"../../components/brutalist/TabBar.js",u=e.defineComponent({__name:"index",setup(t){const n=a.useUserStore(),o=e.computed((()=>n.user||{nickname:"校园用户",avatar:"",gender:"secret",contact:""})),u=e.ref([]),l=e.ref(""),i=e.ref(!1),s=e.ref(0),c=["男","女","保密"],r=["主校区","南校区","北校区","东校区"],v=["校门","教学楼","宿舍楼","食堂","图书馆","体育馆"],d=e.ref(-1),f=e.ref({id:"",name:"",phone:"",campus:"",locationType:"",detail:"",isDefault:!1});function p(){e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:a=>{const t=a.tempFilePaths[0];e.index.uploadFile({url:"https://your-upload-url.com/upload",filePath:t,name:"file",success:e=>{const a=JSON.parse(e.data);o.value.avatar=a.url,_()}})}})}function m(){l.value=o.value.nickname||""}function h(){l.value.trim()?(o.value.nickname=l.value,_(),e.index.showToast({title:"修改成功",icon:"success"})):e.index.showToast({title:"昵称不能为空",icon:"none"})}function x(){}function T(e){const a=e.detail.value;o.value.gender=["male","female","secret"][a],_(),i.value=!1}function y(){e.index.showModal({title:"修改联系方式",editable:!0,placeholderText:o.value.contact||"请输入联系方式",success:e=>{e.confirm&&e.content&&(o.value.contact=e.content,_())}})}function w(){d.value=-1,f.value={id:"",name:"",phone:"",campus:"",locationType:"",detail:"",isDefault:!1}}function g(e){f.value.campus=r[e.detail.value]}function D(e){f.value.locationType=v[e.detail.value]}function S(e){f.value.isDefault=e.detail.value[0]}function b(){d.value=-1}function k(){if(!f.value.name.trim())return void e.index.showToast({title:"请输入联系人",icon:"none"});if(!f.value.phone)return void e.index.showToast({title:"请输入手机号",icon:"none"});if(!/^1[3-9]\d{9}$/.test(f.value.phone))return void e.index.showToast({title:"手机号格式错误",icon:"none"});if(!f.value.campus)return void e.index.showToast({title:"请选择校区",icon:"none"});if(!f.value.locationType)return void e.index.showToast({title:"请选择位置类型",icon:"none"});if(!f.value.detail.trim())return void e.index.showToast({title:"请输入详细位置",icon:"none"});f.value.isDefault&&u.value.forEach((e=>e.isDefault=!1));const a={...f.value,id:f.value.id||"addr_"+Date.now()};d.value>=0?u.value[d.value]=a:u.value.push(a),j(),e.index.showToast({title:"保存成功",icon:"success"})}function _(){n.setUserInfo(o.value),e.index.setStorageSync("userInfo",o.value)}function j(){e.index.setStorageSync("addresses",u.value)}function P(){e.index.showModal({title:"提示",content:"确定要退出登录吗？",success:a=>{a.confirm&&(n.logout(),e.index.showToast({title:"已退出登录",icon:"success"}))}})}return function(){const a=e.index.getStorageSync("addresses");a&&Array.isArray(a)&&(u.value=a)}(),(a,t)=>{var n,_;return e.e({a:o.value.avatar},o.value.avatar?{b:o.value.avatar}:{c:e.t((null==(n=o.value.nickname)?void 0:n.charAt(0))||"U")},{d:e.o(p),e:e.t(o.value.nickname||"校园用户"),f:e.o(m),g:e.p({taped:!0,accent:!0}),h:e.t((_=o.value.gender,{male:"男",female:"女",secret:"保密"}[_||"secret"]||"保密")),i:e.o((e=>i.value=!0)),j:e.t(o.value.contact||"未设置"),k:e.o(y),l:e.o(w),m:0===u.value.length},0===u.value.length?{}:{n:e.f(u.value,((a,t,n)=>e.e({a:e.t(a.name),b:a.isDefault},(a.isDefault,{}),{c:e.o((a=>function(a){e.index.showModal({title:"确认删除",content:"确定要删除该地址吗？",success:e=>{e.confirm&&(u.value.splice(a,1),j())}})}(t)),a.id),d:e.t(a.campus),e:e.t(a.location),f:e.t(a.detail),g:e.t(a.phone),h:a.id,i:e.o((e=>function(e){d.value=e,f.value={...u.value[e]}}(t)),a.id)})))},{o:e.o(P),p:e.p({outline:!0}),q:l.value,r:e.o((e=>l.value=e.detail.value)),s:e.o(x),t:e.o(h),v:e.sr("nicknamePopup","79e6a490-5"),w:e.p({type:"dialog"}),x:c,y:s.value,z:e.o(T),A:i.value,B:e.o((e=>i.value=!1)),C:e.t(d.value>=0?"编辑地址":"新增地址"),D:f.value.name,E:e.o((e=>f.value.name=e.detail.value)),F:f.value.phone,G:e.o((e=>f.value.phone=e.detail.value)),H:e.t(f.value.campus||"请选择校区"),I:r,J:e.o(g),K:e.t(f.value.locationType||"请选择位置类型"),L:v,M:e.o(D),N:f.value.detail,O:e.o((e=>f.value.detail=e.detail.value)),P:f.value.isDefault,Q:e.o(S),R:e.o(b),S:e.o(k),T:e.sr("addressPopup","79e6a490-6"),U:e.p({type:"center"})})}}}),l=e._export_sfc(u,[["__scopeId","data-v-79e6a490"]]);wx.createPage(l);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/user/index.js.map
