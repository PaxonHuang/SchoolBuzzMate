"use strict";const e=require("../common/vendor.js"),n=e.defineStore("user",(()=>{const n=e.ref(null),t=e.ref(""),r=e.computed((()=>!!t.value&&!!n.value)),u=e.computed((()=>n.value));function s(t){n.value=t,e.index.setStorageSync("userInfo",t)}function o(n){t.value=n,e.index.setStorageSync("token",n)}function a(e){const n={_id:"user_"+Date.now(),nickname:"校园用户",avatar:"",campus:"主校区",tags:["学习","运动"]};return o(e),s(n),{success:!0,message:"登录成功",userInfo:n}}return{userInfo:n,token:t,isLoggedIn:r,user:u,setUserInfo:s,setToken:o,login:async function(n){var t,r;try{const u=await e.tr.callFunction({name:"uni-id-cf",data:{method:"loginByWeixin",code:n}});if(0===(null==(t=u.result)?void 0:t.errCode)){const e=u.result.userInfo||{_id:u.result.uid||"user_"+Date.now(),nickname:u.result.nickname||"校园用户",avatar:u.result.avatar||"",campus:u.result.campus||"主校区",tags:u.result.tags||["学习","运动"]};return o(u.result.token||n),s(e),{success:!0,message:"登录成功",userInfo:e}}return e.index.__f__("warn","at stores/user.uts:93","云函数登录失败，使用模拟登录:",null==(r=u.result)?void 0:r.errMsg),a(n)}catch(u){return e.index.__f__("error","at stores/user.uts:96","云函数调用失败，使用模拟登录:",u),a(n)}},logout:async function(){t.value="",n.value=null,e.index.removeStorageSync("token"),e.index.removeStorageSync("userInfo")},checkLoginStatus:function(){const r=e.index.getStorageSync("token"),u=e.index.getStorageSync("userInfo");r&&(t.value=r),u&&(n.value=u)},updateProfile:function(t){n.value&&(n.value={...n.value,...t},e.index.setStorageSync("userInfo",n.value))}}}));exports.useUserStore=n;
//# sourceMappingURL=../../.sourcemap/mp-weixin/stores/user.js.map
