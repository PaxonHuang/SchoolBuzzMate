"use strict";const e=require("../common/vendor.js"),n=e.defineStore("user",(()=>{const n=e.ref(null),t=e.ref(""),r=e.computed((()=>!!t.value&&!!n.value)),s=e.computed((()=>n.value));function u(t){n.value=t,e.index.setStorageSync("userInfo",t)}function o(n){t.value=n,e.index.setStorageSync("token",n)}function a(e){const n={_id:"user_"+Date.now(),nickname:"校园用户",avatar:"",campus:"主校区",tags:["学习","运动"]};return o(e),u(n),{success:!0,message:"登录成功",userInfo:n}}return{userInfo:n,token:t,isLoggedIn:r,user:s,setUserInfo:u,setToken:o,login:async function(n){var t,r;try{const s=await e.tr.callFunction({name:"uni-id-cf",data:{method:"loginByWeixin",code:n}});if(0===(null==(t=s.result)?void 0:t.errCode)){const e=s.result.userInfo||{_id:s.result.uid||"user_"+Date.now(),nickname:s.result.nickname||"校园用户",avatar:s.result.avatar||"",campus:s.result.campus||"主校区",tags:s.result.tags||["学习","运动"]};return o(s.result.token||n),u(e),{success:!0,message:"登录成功",userInfo:e}}return e.index.__f__("warn","at stores/user.uts:81","云函数登录失败，使用模拟登录:",null==(r=s.result)?void 0:r.errMsg),a(n)}catch(s){return e.index.__f__("error","at stores/user.uts:84","云函数调用失败，使用模拟登录:",s),a(n)}},logout:async function(){t.value="",n.value=null,e.index.removeStorageSync("token"),e.index.removeStorageSync("userInfo")},checkLoginStatus:function(){const r=e.index.getStorageSync("token"),s=e.index.getStorageSync("userInfo");r&&(t.value=r),s&&(n.value=s)}}}));exports.useUserStore=n;
//# sourceMappingURL=../../.sourcemap/mp-weixin/stores/user.js.map
