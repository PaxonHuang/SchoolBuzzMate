{"version":3,"file":"index.js","sources":["pages/messages/index.vue","../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVzc2FnZXMvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"page-container\">\n    <view class=\"page-doodle-1\">‚ú¶</view>\n    <view class=\"page-doodle-2\">‚óâ</view>\n\n    <brutalist-card class=\"page-header\" taped accent>\n      <text class=\"page-title\">Ê∂àÊÅØ‰∏≠ÂøÉ</text>\n      <text class=\"page-subtitle\">Êü•ÁúãÊúÄÊñ∞Âä®ÊÄÅ</text>\n    </brutalist-card>\n\n    <view class=\"filter-tabs\">\n      <view\n        v-for=\"tab in tabs\"\n        :key=\"tab.value\"\n        class=\"filter-tab\"\n        :class=\"{ 'active': currentTab === tab.value }\"\n        @click=\"switchTab(tab.value)\"\n      >\n        <text class=\"tab-emoji\">{{ tab.emoji }}</text>\n        <text class=\"tab-label\">{{ tab.label }}</text>\n        <text v-if=\"getUnreadCount(tab.value) > 0\" class=\"tab-badge\">\n          {{ getUnreadCount(tab.value) }}\n        </text>\n      </view>\n    </view>\n\n    <view class=\"message-list\">\n      <view\n        v-for=\"message in filteredMessages\"\n        :key=\"message._id\"\n        class=\"message-item\"\n        :class=\"{ 'unread': !message.read }\"\n        @click=\"viewMessage(message)\"\n      >\n        <view class=\"message-icon\" :class=\"'message-icon-' + message.type\">\n          <text>{{ getMessageIcon(message.type) }}</text>\n        </view>\n\n        <view class=\"message-content\">\n          <view class=\"message-header\">\n            <text class=\"message-title\">{{ message.title || getMessageTitle(message.type) }}</text>\n            <text class=\"message-time\">{{ formatTime(message.timestamp) }}</text>\n          </view>\n          <text class=\"message-preview\">{{ message.content }}</text>\n          <view v-if=\"message.orderInfo\" class=\"order-info\">\n            <text class=\"order-label\">ËÆ¢Âçï‰ø°ÊÅØÔºö</text>\n            <text>{{ message.orderInfo }}</text>\n          </view>\n        </view>\n\n        <view v-if=\"!message.read\" class=\"unread-dot\"></view>\n      </view>\n    </view>\n\n    <view v-if=\"filteredMessages.length === 0\" class=\"empty-state\">\n      <brutalist-card class=\"empty-card\" dashed>\n        <text class=\"empty-icon\">üì≠</text>\n        <text class=\"empty-text\">ÊöÇÊó†{{ getTabLabel() }}Ê∂àÊÅØ</text>\n        <text class=\"empty-hint\">ÂéªÈÄõÈÄõÂÖ∂‰ªñÈ°µÈù¢ÂêßÔºÅ</text>\n      </brutalist-card>\n    </view>\n\n    <TabBar />\n  </view>\n</template>\n\n<script setup lang=\"uts\">\nimport { ref, computed } from 'vue'\nimport { onPullDownRefresh } from '@dcloudio/uni-app'\nimport { useUserStore } from '@/stores/user'\nimport BrutalistCard from '@/components/brutalist/BrutalistCard.vue'\nimport TabBar from '@/components/brutalist/TabBar.vue'\n\ninterface Message {\n  _id: string\n  type: string\n  title?: string\n  content: string\n  timestamp: number\n  read: boolean\n  orderInfo?: string\n}\n\ninterface Tab {\n  label: string\n  value: string\n  emoji: string\n}\n\nconst userStore = useUserStore()\nconst messages = ref<Message[]>([])\nconst currentTab = ref<string>('all')\n\nconst tabs: Tab[] = [\n  { label: 'ÂÖ®ÈÉ®', value: 'all', emoji: 'üìã' },\n  { label: 'ËÆ¢Âçï', value: 'order', emoji: 'üì¶' },\n  { label: 'ËØÑËÆ∫', value: 'comment', emoji: 'üí¨' },\n  { label: 'ÁÇπËµû', value: 'like', emoji: '‚ù§Ô∏è' },\n  { label: 'ÁßÅ‰ø°', value: 'chat', emoji: '‚úâÔ∏è' },\n  { label: 'Á≥ªÁªü', value: 'system', emoji: 'üîî' }\n]\n\nconst filteredMessages = computed(() => {\n  if (currentTab.value === 'all') {\n    return messages.value\n  }\n  return messages.value.filter(m => m.type === currentTab.value)\n})\n\nfunction switchTab(tab: string) {\n  currentTab.value = tab\n}\n\nfunction getUnreadCount(type?: string): number {\n  if (type === 'all') {\n    return messages.value.filter(m => !m.read).length\n  }\n  return messages.value.filter(m => !m.read && m.type === type).length\n}\n\nfunction getTabLabel(): string {\n  const tab = tabs.find(t => t.value === currentTab.value)\n  return tab?.label || ''\n}\n\nfunction getMessageIcon(type: string): string {\n  const iconMap: Record<string, string> = {\n    'order': 'üì¶',\n    'comment': 'üí¨',\n    'like': '‚ù§Ô∏è',\n    'system': 'üîî',\n    'chat': '‚úâÔ∏è'\n  }\n  return iconMap[type] || 'üîî'\n}\n\nfunction getMessageTitle(type: string): string {\n  const titleMap: Record<string, string> = {\n    'order': 'ËÆ¢ÂçïÈÄöÁü•',\n    'comment': 'Êñ∞ËØÑËÆ∫',\n    'like': 'ÁÇπËµûÊèêÈÜí',\n    'system': 'Á≥ªÁªüÊ∂àÊÅØ',\n    'chat': 'ÁßÅ‰ø°Ê∂àÊÅØ'\n  }\n  return titleMap[type] || 'Êñ∞Ê∂àÊÅØ'\n}\n\nfunction formatTime(timestamp: number): string {\n  const date = new Date(timestamp)\n  const now = new Date()\n  const diff = now.getTime() - date.getTime()\n\n  if (diff < 60000) {\n    return 'ÂàöÂàö'\n  } else if (diff < 3600000) {\n    return Math.floor(diff / 60000) + 'ÂàÜÈíüÂâç'\n  } else if (diff < 86400000) {\n    return Math.floor(diff / 3600000) + 'Â∞èÊó∂Ââç'\n  } else if (diff < 604800000) {\n    return Math.floor(diff / 86400000) + 'Â§©Ââç'\n  } else {\n    const month = date.getMonth() + 1\n    const day = date.getDate()\n    return month + 'Êúà' + day + 'Êó•'\n  }\n}\n\nfunction viewMessage(message: Message) {\n  if (!message.read) {\n    message.read = true\n    saveMessages()\n  }\n\n  if (message.type === 'order' && message.orderInfo) {\n    uni.showModal({\n      title: 'ËÆ¢ÂçïËØ¶ÊÉÖ',\n      content: message.orderInfo,\n      showCancel: false\n    })\n  } else {\n    uni.showModal({\n      title: message.title || getMessageTitle(message.type),\n      content: message.content,\n      showCancel: false\n    })\n  }\n}\n\nasync function loadMessages() {\n  try {\n    const db = uniCloud.database()\n    const userId = userStore.user?._id || ''\n\n    const res = await db.collection('messages')\n      .where(`receiver == '${userId}' || sender == '${userId}'`)\n      .orderBy('timestamp desc', 'desc')\n      .limit(50)\n      .get()\n\n    messages.value = res.data.map((item: any) => ({\n      ...item,\n      timestamp: item.timestamp || Date.now()\n    })) as Message[]\n  } catch (e) {\n    uni.__f__('error','at pages/messages/index.vue:205','Âä†ËΩΩÊ∂àÊÅØÂ§±Ë¥•:', e)\n\n    const localMessages = uni.getStorageSync('messages') || []\n\n    if (localMessages.length > 0) {\n      messages.value = localMessages.map((item: any) => ({\n        ...item,\n        timestamp: item.timestamp || Date.now()\n      }))\n    } else {\n      messages.value = [\n        {\n          _id: '1',\n          type: 'order',\n          title: 'ËÆ¢ÂçïÂ∑≤Êé•Âçï',\n          content: 'ÊÇ®ÁöÑË∑ëËÖøËÆ¢ÂçïÂ∑≤Ë¢´‰∫∫Êé•ÂçïÔºåËØ∑‰øùÊåÅËÅîÁ≥ª',\n          timestamp: Date.now() - 1800000,\n          read: false,\n          orderInfo: '‰ªªÂä°ÔºöÂ∏ÆÂøôÂèñ‰∏™Âø´ÈÄí\\nÊé•Âçï‰∫∫ÔºöÂ∞èÁéã\\nË¥πÁî®Ôºö¬•5'\n        },\n        {\n          _id: '2',\n          type: 'comment',\n          title: 'Êñ∞ËØÑËÆ∫',\n          content: 'Áî®Êà∑\"Â≠¶‰π†Ëææ‰∫∫\"ËØÑËÆ∫‰∫Ü‰Ω†ÁöÑÂ∏ñÂ≠ê',\n          timestamp: Date.now() - 7200000,\n          read: true\n        },\n        {\n          _id: '3',\n          type: 'like',\n          title: 'Êî∂Âà∞ÁÇπËµû',\n          content: '‰Ω†ÁöÑÂ∏ñÂ≠ê\"Âõæ‰π¶È¶ÜÁ∫¶Â≠¶‰π†Êê≠Â≠ê\"Ëé∑Âæó‰∫ÜÊñ∞ÁÇπËµû',\n          timestamp: Date.now() - 14400000,\n          read: false\n        },\n        {\n          _id: '4',\n          type: 'system',\n          title: 'Á≥ªÁªüÈÄöÁü•',\n          content: 'Ê¨¢Ëøé‰ΩøÁî®Ê†°Ë∂£Èó™Êê≠ÔºÅËøôÈáåÊòØ‰Ω†ÁöÑÊ†°Âõ≠ÁîüÊ¥ªÊúçÂä°Âπ≥Âè∞',\n          timestamp: Date.now() - 28800000,\n          read: true\n        },\n        {\n          _id: '5',\n          type: 'chat',\n          title: 'ÁßÅ‰ø°Ê∂àÊÅØ',\n          content: 'ÁæéÈ£üÊé¢Á¥¢ÂÆ∂ÔºöÈÇ£ÂÆ∂È∫ªËæ£ÁÉ´Á°ÆÂÆû‰∏çÈîôÔºÅ',\n          timestamp: Date.now() - 43200000,\n          read: false\n        }\n      ] as Message[]\n    }\n\n    saveMessages()\n  }\n}\n\nfunction saveMessages() {\n  uni.setStorageSync('messages', messages.value)\n}\n\nloadMessages()\n\nonPullDownRefresh(async () => {\n  await loadMessages()\n  uni.stopPullDownRefresh()\n})\n</script>\n\n<style lang=\"scss\" scoped>\n$black: #000000;\n$white: #ffffff;\n$red: #FF6B6B;\n$teal: #4ECDC4;\n$yellow: #FFE66D;\n\n.page-container {\n  min-height: 100vh;\n  padding: 24rpx;\n  padding-bottom: 160rpx;\n  background: linear-gradient(180deg, #FFF9E6 0%, #ffffff 50%, #FFE6F0 100%);\n  position: relative;\n}\n\n.page-doodle {\n  &-1 {\n    position: fixed;\n    top: 140rpx;\n    right: 40rpx;\n    font-size: 44rpx;\n    color: $teal;\n    opacity: 0.3;\n    animation: spin 10s linear infinite;\n    z-index: 0;\n  }\n\n  &-2 {\n    position: fixed;\n    top: 380rpx;\n    left: 40rpx;\n    font-size: 38rpx;\n    color: $yellow;\n    opacity: 0.35;\n    animation: pulse 2.5s ease-in-out infinite;\n    z-index: 0;\n  }\n}\n\n.page-header {\n  text-align: center;\n  padding: 32rpx 24rpx !important;\n  margin-bottom: 24rpx !important;\n\n  .page-title {\n    display: block;\n    font-size: 48rpx;\n    font-weight: 900;\n    color: $black;\n    margin-bottom: 8rpx;\n    letter-spacing: 2rpx;\n  }\n\n  .page-subtitle {\n    display: block;\n    font-size: 24rpx;\n    color: #666;\n  }\n}\n\n.filter-tabs {\n  display: flex;\n  gap: 12rpx;\n  margin-bottom: 32rpx;\n  overflow-x: auto;\n  padding-bottom: 8rpx;\n\n  .filter-tab {\n    display: flex;\n    align-items: center;\n    gap: 6rpx;\n    padding: 12rpx 20rpx;\n    border: 3rpx solid $black;\n    background: $white;\n    box-shadow: 3rpx 3rpx 0 $black;\n    white-space: nowrap;\n    transition: all 0.2s ease;\n    position: relative;\n\n    .tab-emoji {\n      font-size: 24rpx;\n    }\n\n    .tab-label {\n      font-size: 24rpx;\n      font-weight: 700;\n    }\n\n    .tab-badge {\n      position: absolute;\n      top: -8rpx;\n      right: -8rpx;\n      min-width: 28rpx;\n      height: 28rpx;\n      padding: 0 6rpx;\n      border-radius: 14rpx;\n      background: $red;\n      color: $white;\n      font-size: 18rpx;\n      font-weight: 900;\n      text-align: center;\n      line-height: 28rpx;\n      box-shadow: 2rpx 2rpx 0 $black;\n    }\n\n    &.active {\n      background: $teal;\n      transform: translate(-1rpx, -1rpx);\n      box-shadow: 4rpx 4rpx 0 $black;\n    }\n\n    &:active {\n      transform: translate(2rpx, 2rpx);\n      box-shadow: 1rpx 1rpx 0 $black;\n    }\n  }\n}\n\n.message-list {\n  display: flex;\n  flex-direction: column;\n  gap: 16rpx;\n}\n\n.message-item {\n  display: flex;\n  gap: 16rpx;\n  padding: 20rpx;\n  border: 3rpx solid $black;\n  background: $white;\n  box-shadow: 4rpx 4rpx 0 $black;\n  transition: all 0.2s ease;\n  position: relative;\n\n  &.unread {\n    background: #FFF9E6;\n  }\n\n  &:active {\n    transform: translate(2rpx, 2rpx);\n    box-shadow: 2rpx 2rpx 0 $black;\n  }\n\n  .message-icon {\n    width: 80rpx;\n    height: 80rpx;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 40rpx;\n    box-shadow: 3rpx 3rpx 0 $black;\n    flex-shrink: 0;\n\n    &-order {\n      background: $yellow;\n    }\n\n    &-comment {\n      background: #FFE0E0;\n    }\n\n    &-like {\n      background: #E0FFE0;\n    }\n\n    &-system {\n      background: #E0E8FF;\n    }\n\n    &-chat {\n      background: #FFE0FF;\n    }\n  }\n\n  .message-content {\n    flex: 1;\n    min-width: 0;\n  }\n\n  .message-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    margin-bottom: 8rpx;\n    gap: 12rpx;\n  }\n\n  .message-title {\n    font-size: 28rpx;\n    font-weight: 700;\n    color: $black;\n  }\n\n  .message-time {\n    font-size: 22rpx;\n    color: #999;\n    flex-shrink: 0;\n  }\n\n  .message-preview {\n    display: block;\n    font-size: 24rpx;\n    color: #666;\n    line-height: 1.5;\n    margin-bottom: 8rpx;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n  }\n\n  .order-info {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 4rpx;\n    padding: 12rpx;\n    background: #F5F5F5;\n    border: 2rpx dashed #ccc;\n    font-size: 22rpx;\n    color: #666;\n    line-height: 1.5;\n  }\n\n  .order-label {\n    font-weight: 700;\n  }\n\n  .unread-dot {\n    position: absolute;\n    top: 20rpx;\n    right: 20rpx;\n    width: 16rpx;\n    height: 16rpx;\n    border-radius: 50%;\n    background: $red;\n    box-shadow: 2rpx 2rpx 0 $black;\n  }\n}\n\n.empty-state {\n  padding: 80rpx 0;\n}\n\n.empty-card {\n  text-align: center;\n  padding: 64rpx 32rpx !important;\n\n  .empty-icon {\n    display: block;\n    font-size: 96rpx;\n    margin-bottom: 24rpx;\n  }\n\n  .empty-text {\n    display: block;\n    font-size: 28rpx;\n    font-weight: 700;\n    color: $black;\n    margin-bottom: 12rpx;\n  }\n\n  .empty-hint {\n    display: block;\n    font-size: 24rpx;\n    color: #999;\n  }\n}\n\n@keyframes spin {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n\n@keyframes pulse {\n  0%, 100% { transform: scale(1); }\n  50% { transform: scale(1.15); }\n}\n</style>\n","import MiniProgramPage from 'E:/codeplace/test/pages/messages/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["BrutalistCard","TabBar","userStore","useUserStore","messages","ref","currentTab","tabs","label","value","emoji","filteredMessages","computed","filter","m","type","getUnreadCount","read","length","getTabLabel","tab","find","t","getMessageTitle","order","comment","like","system","chat","formatTime","timestamp","date","Date","diff","getTime","Math","floor","getMonth","getDate","async","loadMessages","db","uniCloud","database","userId","_a","user","_id","res","collection","where","orderBy","limit","get","data","map","item","now","e","uni","index","__f__","localMessages","getStorageSync","title","content","orderInfo","saveMessages","setStorageSync","onPullDownRefresh","stopPullDownRefresh","message","showModal","showCancel","wx","createPage","MiniProgramPage"],"mappings":"uGAsEA,MAAAA,EAA0B,IAAA,8CAC1BC,EAAmB,IAAA,oFAkBb,MAAAC,EAAYC,EAAAA,eACZC,EAAWC,MAAe,IAC1BC,EAAaD,MAAY,OAEzBE,EAAc,CAClB,CAAEC,MAAO,KAAMC,MAAO,MAAOC,MAAO,MACpC,CAAEF,MAAO,KAAMC,MAAO,QAASC,MAAO,MACtC,CAAEF,MAAO,KAAMC,MAAO,UAAWC,MAAO,MACxC,CAAEF,MAAO,KAAMC,MAAO,OAAQC,MAAO,MACrC,CAAEF,MAAO,KAAMC,MAAO,OAAQC,MAAO,MACrC,CAAEF,MAAO,KAAMC,MAAO,SAAUC,MAAO,OAGnCC,EAAmBC,EAAAA,UAAS,IACP,QAArBN,EAAWG,MACNL,EAASK,MAEXL,EAASK,MAAMI,WAAYC,EAAEC,OAAST,EAAWG,UAO1D,SAASO,EAAeD,GACtB,MAAa,QAATA,EACKX,EAASK,MAAMI,YAAaC,EAAEG,OAAMC,OAEtCd,EAASK,MAAMI,QAAYC,IAACA,EAAEG,MAAQH,EAAEC,OAASA,IAAMG,MAChE,CAEA,SAASC,IACD,MAAAC,EAAMb,EAAKc,SAAUC,EAAEb,QAAUH,EAAWG,QAClD,aAAOW,WAAKZ,QAAS,EACvB,CAaA,SAASe,EAAgBR,GAQhB,MAPkC,CACvCS,MAAS,OACTC,QAAW,MACXC,KAAQ,OACRC,OAAU,OACVC,KAAQ,QAEMb,IAAS,KAC3B,CAEA,SAASc,EAAWC,GACZ,MAAAC,EAAO,IAAIC,KAAKF,GAEhBG,OADUD,MACCE,UAAYH,EAAKG,UAElC,GAAID,EAAO,IACF,MAAA,KAAA,GACEA,EAAO,KAChB,OAAOE,KAAKC,MAAMH,EAAO,KAAS,MAAA,GACzBA,EAAO,MAChB,OAAOE,KAAKC,MAAMH,EAAO,MAAW,MAAA,GAC3BA,EAAO,OAChB,OAAOE,KAAKC,MAAMH,EAAO,OAAY,KAI9B,OAFOF,EAAKM,WAAa,EAEjB,IADHN,EAAKO,UACU,GAE/B,CAuBAC,eAAeC,UACT,IACI,MAAAC,EAAKC,KAASC,WACdC,GAAS,OAAAC,EAAA3C,EAAU4C,WAAV,EAAAD,EAAgBE,MAAO,GAEhCC,QAAYP,EAAGQ,WAAW,YAC7BC,MAAM,gBAAgBN,oBAAyBA,MAC/CO,QAAQ,iBAAkB,QAC1BC,MAAM,IACNC,MAEHjD,EAASK,MAAQuC,EAAIM,KAAKC,KAAKC,IAAe,IACzCA,EACH1B,UAAW0B,EAAK1B,WAAaE,KAAKyB,SA2DtC,OAzDSC,GACPC,EAAAC,MAAIC,MAAM,QAAQ,kCAAkC,UAAWH,GAE/D,MAAMI,EAAgBH,EAAAC,MAAIG,eAAe,aAAe,GAEpDD,EAAc5C,OAAS,EACzBd,EAASK,MAAQqD,EAAcP,KAAKC,IAAe,IAC9CA,EACH1B,UAAW0B,EAAK1B,WAAaE,KAAKyB,UAGpCrD,EAASK,MAAQ,CACf,CACEsC,IAAK,IACLhC,KAAM,QACNiD,MAAO,QACPC,QAAS,oBACTnC,UAAWE,KAAKyB,MAAQ,KACxBxC,MAAM,EACNiD,UAAW,4BAEb,CACEnB,IAAK,IACLhC,KAAM,UACNiD,MAAO,MACPC,QAAS,kBACTnC,UAAWE,KAAKyB,MAAQ,KACxBxC,MAAM,GAER,CACE8B,IAAK,IACLhC,KAAM,OACNiD,MAAO,OACPC,QAAS,uBACTnC,UAAWE,KAAKyB,MAAQ,MACxBxC,MAAM,GAER,CACE8B,IAAK,IACLhC,KAAM,SACNiD,MAAO,OACPC,QAAS,yBACTnC,UAAWE,KAAKyB,MAAQ,MACxBxC,MAAM,GAER,CACE8B,IAAK,IACLhC,KAAM,OACNiD,MAAO,OACPC,QAAS,mBACTnC,UAAWE,KAAKyB,MAAQ,MACxBxC,MAAM,OAMd,CACF,CAEA,SAASkD,IACHR,EAAAA,MAAAS,eAAe,WAAYhE,EAASK,MAC1C,YAIA4D,EAAAA,mBAAkB9B,gBACVC,IACNmB,EAAAC,MAAIU,qBAAoB,mMAlK1B,SAAmBlD,GACjBd,EAAWG,MAAQW,CACrB,qEAcwBL,SACkB,CACtCS,MAAS,KACTC,QAAW,KACXC,KAAQ,KACRC,OAAU,KACVC,KAAQ,MAEKb,IAAS,kNAkC1B,SAAqBwD,GACdA,EAAQtD,OACXsD,EAAQtD,MAAO,OAII,UAAjBsD,EAAQxD,MAAoBwD,EAAQL,UACtCP,EAAAA,MAAIa,UAAU,CACZR,MAAO,OACPC,QAASM,EAAQL,UACjBO,YAAY,IAGdd,EAAAA,MAAIa,UAAU,CACZR,MAAOO,EAAQP,OAASzC,EAAgBgD,EAAQxD,MAChDkD,QAASM,EAAQN,QACjBQ,YAAY,GAGlB,eA7DA,IAAwB1D,0IC5HxB2D,GAAGC,WAAWC"}