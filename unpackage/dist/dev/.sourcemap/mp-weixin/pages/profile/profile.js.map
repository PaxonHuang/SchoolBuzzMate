{"version":3,"file":"profile.js","sources":["pages/profile/profile.vue","../../../../HbuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9wcm9maWxlLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"profile-container\">\r\n    <view class=\"profile-card\">\r\n      <view class=\"user-header\">\r\n        <image class=\"avatar\" :src=\"userInfo.avatar\" mode=\"aspectFill\"></image>\r\n        <text class=\"nickname\">{{userInfo.nickname}}</text>\r\n        <view class=\"user-tags\">\r\n          <text class=\"tag\" v-if=\"userInfo.isPhoneVerified\">已绑定手机</text>\r\n          <text class=\"tag\" v-if=\"userInfo.wxOpenId\">微信用户</text>\r\n        </view>\r\n      </view>\r\n      \r\n      <view class=\"profile-info\">\r\n        <view class=\"info-item\">\r\n          <text class=\"info-label\">手机号</text>\r\n          <text class=\"info-value\">{{userInfo.phone ? userInfo.phone.replace(/(\\d{3})\\d{4}(\\d{4})/, '$1****$2') : '未绑定'}}</text>\r\n        </view>\r\n        \r\n        <view class=\"info-item\">\r\n          <text class=\"info-label\">注册时间</text>\r\n          <text class=\"info-value\">{{formatDate(userInfo.createTime)}}</text>\r\n        </view>\r\n      </view>\r\n      \r\n      <view class=\"action-buttons\">\r\n        <button class=\"action-btn brutalist-btn\" @tap=\"editProfile\">编辑资料</button>\r\n        <button class=\"action-btn brutalist-btn brutalist-btn-secondary\" @tap=\"logout\">退出登录</button>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      userInfo: {}\r\n    }\r\n  },\r\n  onLoad() {\r\n    // 获取用户信息\r\n    this.getUserInfo()\r\n  },\r\n  methods: {\r\n    // 获取用户信息\r\n    async getUserInfo() {\r\n      try {\r\n        const token = uni.getStorageSync('token')\r\n        if (!token) {\r\n          // 没有token，跳转到登录页\r\n          uni.redirectTo({\r\n            url: '/pages/login/login'\r\n          })\r\n          return\r\n        }\r\n        \r\n        const res = await uniCloud.callFunction({\r\n          name: 'validate-token',\r\n          data: { token }\r\n        })\r\n        \r\n        if (res.result.success) {\r\n          this.userInfo = res.result.userInfo\r\n        } else {\r\n          // token无效，跳转到登录页\r\n          uni.removeStorageSync('token')\r\n          uni.removeStorageSync('userInfo')\r\n          uni.redirectTo({\r\n            url: '/pages/login/login'\r\n          })\r\n        }\r\n      } catch (error) {\r\n        console.error('获取用户信息失败:', error)\r\n        uni.redirectTo({\r\n          url: '/pages/login/login'\r\n        })\r\n      }\r\n    },\r\n    \r\n    // 格式化日期\r\n    formatDate(dateStr) {\r\n      if (!dateStr) return ''\r\n      \r\n      const date = new Date(dateStr)\r\n      const year = date.getFullYear()\r\n      const month = date.getMonth() + 1\r\n      const day = date.getDate()\r\n      \r\n      return `${year}年${month}月${day}日`\r\n    },\r\n    \r\n    // 编辑资料\r\n    editProfile() {\r\n      uni.showToast({\r\n        title: '功能开发中',\r\n        icon: 'none'\r\n      })\r\n    },\r\n    \r\n    // 退出登录\r\n    logout() {\r\n      uni.showModal({\r\n        title: '提示',\r\n        content: '确定要退出登录吗？',\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            // 清除本地存储\r\n            uni.removeStorageSync('token')\r\n            uni.removeStorageSync('userInfo')\r\n            \r\n            // 跳转到登录页\r\n            uni.redirectTo({\r\n              url: '/pages/login/login'\r\n            })\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.profile-container {\r\n  min-height: 100vh;\r\n  background-color: #FFFFFF;\r\n  padding: 40rpx;\r\n}\r\n\r\n.profile-card {\r\n  width: 100%;\r\n  background-color: #FFFFFF;\r\n  padding: 60rpx 40rpx;\r\n  border: 8rpx solid #000000;\r\n  box-shadow: 12rpx 12rpx 0px #000000;\r\n  transform: rotate(-1deg);\r\n}\r\n\r\n.user-header {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-bottom: 60rpx;\r\n}\r\n\r\n.avatar {\r\n  width: 160rpx;\r\n  height: 160rpx;\r\n  border-radius: 50%;\r\n  border: 4rpx solid #000000;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.nickname {\r\n  font-size: 36rpx;\r\n  font-weight: 700;\r\n  color: #000000;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.user-tags {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  justify-content: center;\r\n}\r\n\r\n.tag {\r\n  padding: 6rpx 20rpx;\r\n  background-color: #FFE66D;\r\n  border: 2rpx solid #000000;\r\n  font-size: 24rpx;\r\n  color: #000000;\r\n  margin: 0 10rpx 10rpx 0;\r\n}\r\n\r\n.profile-info {\r\n  margin-bottom: 60rpx;\r\n}\r\n\r\n.info-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  padding: 20rpx 0;\r\n  border-bottom: 2rpx solid #EEEEEE;\r\n}\r\n\r\n.info-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.info-label {\r\n  font-size: 30rpx;\r\n  color: #666666;\r\n}\r\n\r\n.info-value {\r\n  font-size: 30rpx;\r\n  color: #000000;\r\n  font-weight: 700;\r\n}\r\n\r\n.action-buttons {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 20rpx;\r\n}\r\n\r\n.action-btn {\r\n  width: 100%;\r\n  height: 80rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border: 4rpx solid #000000;\r\n  box-shadow: 6rpx 6rpx 0px #000000;\r\n}\r\n\r\n.action-btn:active {\r\n  transform: translate(3rpx, 3rpx);\r\n  box-shadow: 3rpx 3rpx 0px #000000;\r\n}\r\n\r\n.action-btn {\r\n  background-color: #FF6B6B;\r\n}\r\n\r\n.brutalist-btn-secondary {\r\n  background-color: #FFE66D;\r\n}\r\n\r\n.action-btn text {\r\n  font-size: 32rpx;\r\n  font-weight: 700;\r\n  color: #000000;\r\n}\r\n</style>","import MiniProgramPage from 'E:/NJTS-Codeprojects-2023/WechatMiniproject/SupabaseSchoolAPP/SchoolBUZZUniAPPUnicloudTESTTEST/pages/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":";;AAiCA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,UAAU,CAAC;AAAA,IACb;AAAA,EACD;AAAA,EACD,SAAS;AAEP,SAAK,YAAY;AAAA,EAClB;AAAA,EACD,SAAS;AAAA;AAAA,IAEP,MAAM,cAAc;AAClB,UAAI;AACF,cAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,YAAI,CAAC,OAAO;AAEVA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK;AAAA,WACN;AACD;AAAA,QACF;AAEA,cAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACtC,MAAM;AAAA,UACN,MAAM,EAAE,MAAM;AAAA,SACf;AAED,YAAI,IAAI,OAAO,SAAS;AACtB,eAAK,WAAW,IAAI,OAAO;AAAA,eACtB;AAELD,wBAAG,MAAC,kBAAkB,OAAO;AAC7BA,wBAAG,MAAC,kBAAkB,UAAU;AAChCA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK;AAAA,WACN;AAAA,QACH;AAAA,MACA,SAAO,OAAO;AACdA,sBAAAA,MAAc,MAAA,SAAA,mCAAA,aAAa,KAAK;AAChCA,sBAAAA,MAAI,WAAW;AAAA,UACb,KAAK;AAAA,SACN;AAAA,MACH;AAAA,IACD;AAAA;AAAA,IAGD,WAAW,SAAS;AAClB,UAAI,CAAC;AAAS,eAAO;AAErB,YAAM,OAAO,IAAI,KAAK,OAAO;AAC7B,YAAM,OAAO,KAAK,YAAY;AAC9B,YAAM,QAAQ,KAAK,SAAQ,IAAK;AAChC,YAAM,MAAM,KAAK,QAAQ;AAEzB,aAAO,GAAG,IAAI,IAAI,KAAK,IAAI,GAAG;AAAA,IAC/B;AAAA;AAAA,IAGD,cAAc;AACZA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,OACP;AAAA,IACF;AAAA;AAAA,IAGD,SAAS;AACPA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AAEfA,0BAAG,MAAC,kBAAkB,OAAO;AAC7BA,0BAAG,MAAC,kBAAkB,UAAU;AAGhCA,0BAAAA,MAAI,WAAW;AAAA,cACb,KAAK;AAAA,aACN;AAAA,UACH;AAAA,QACF;AAAA,OACD;AAAA,IACH;AAAA,EACF;AACF;;;;;;;;;;;;;;;;ACtHA,GAAG,WAAW,eAAe;"}