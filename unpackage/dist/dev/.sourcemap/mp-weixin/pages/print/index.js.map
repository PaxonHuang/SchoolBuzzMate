{"version":3,"file":"index.js","sources":["pages/print/index.vue","../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJpbnQvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部操作栏 -->\n    <view class=\"header-actions\">\n      <brutalist-button accent @click=\"navigateToCreate\">\n        + 打印文件\n      </brutalist-button>\n    </view>\n\n    <!-- 打印店选择 -->\n    <brutalist-card class=\"shop-filter\">\n      <text class=\"section-title\">选择打印店</text>\n      <picker\n        :range=\"printShops\"\n        :value=\"selectedShopIndex\"\n        @change=\"onShopChange\"\n      >\n        <view class=\"picker-display\">\n          {{ selectedShopIndex !== null ? printShops[selectedShopIndex] : '全部打印店' }}\n        </view>\n      </picker>\n    </brutalist-card>\n\n    <!-- 打印记录列表 -->\n    <view class=\"print-list\">\n      <brutalist-card\n        v-for=\"print in filteredPrints\"\n        :key=\"print._id\"\n        class=\"print-card\"\n        @click=\"viewDetail(print)\"\n      >\n        <view class=\"print-header\">\n          <text class=\"print-title\">{{ print.title }}</text>\n          <text class=\"print-status\" :class=\"'status-' + print.status\">\n            {{ getStatusText(print.status) }}\n          </text>\n        </view>\n\n        <view class=\"print-info\">\n          <text class=\"info-item\">打印店：{{ print.shopName }}</text>\n          <text class=\"info-item\">规格：{{ print.option }}</text>\n          <text class=\"info-item\">份数：{{ print.copies }}份</text>\n        </view>\n\n        <view class=\"print-footer\">\n          <text class=\"print-time\">{{ formatTime(print.createTime) }}</text>\n          <text class=\"print-amount\">¥{{ print.amount }}</text>\n        </view>\n      </brutalist-card>\n    </view>\n\n    <!-- 空状态 -->\n    <view v-if=\"filteredPrints.length === 0\" class=\"empty-state\">\n      <text>暂无打印记录</text>\n    </view>\n  </view>\n</template>\n\n<script setup lang=\"uts\">\nimport { ref, computed, onMounted } from 'vue'\nimport { useUserStore } from '@/stores/user'\nimport BrutalistCard from '@/components/brutalist/BrutalistCard.vue'\nimport BrutalistButton from '@/components/brutalist/BrutalistButton.vue'\n\n// 定义打印记录接口\ninterface PrintRecord {\n  _id: string\n  title: string\n  shopName: string\n  option: string\n  copies: number\n  amount: number\n  status: string\n  createTime: number\n  fileId: string\n}\n\nconst userStore = useUserStore()\n\nconst prints = ref<PrintRecord[]>([])\nconst selectedShopIndex = ref<number | null>(null)\n\n// 打印店列表\nconst printShops = [\n  '全部打印店',\n  '图书馆一楼打印店',\n  '学生活动中心B座打印点',\n  '东门校外打印店（5分钟）',\n  '西门快印中心'\n]\n\n// 筛选后的打印记录\nconst filteredPrints = computed(() => {\n  if (selectedShopIndex.value === null || selectedShopIndex.value === 0) {\n    return prints.value\n  }\n  return prints.value.filter(print => print.shopName === printShops[selectedShopIndex.value])\n})\n\n// 打印店变更\nfunction onShopChange(e: any) {\n  selectedShopIndex.value = e.detail.value\n}\n\n// 获取状态文本\nfunction getStatusText(status: string): string {\n  const statusMap: Record<string, string> = {\n    'pending': '待支付',\n    'paid': '待打印',\n    'printing': '打印中',\n    'completed': '已完成',\n    'cancelled': '已取消'\n  }\n  return statusMap[status] || status\n}\n\n// 格式化时间\nfunction formatTime(timestamp: number): string {\n  const date = new Date(timestamp)\n  const now = new Date()\n  const diff = now.getTime() - date.getTime()\n\n  if (diff < 60000) {\n    return '刚刚'\n  } else if (diff < 3600000) {\n    return Math.floor(diff / 60000) + '分钟前'\n  } else if (diff < 86400000) {\n    return Math.floor(diff / 3600000) + '小时前'\n  } else {\n    return Math.floor(diff / 86400000) + '天前'\n  }\n}\n\n// 导航到创建页面\nfunction navigateToCreate() {\n  if (!userStore.isLoggedIn) {\n    uni.showToast({\n      title: '请先登录',\n      icon: 'none'\n    })\n    return\n  }\n\n  uni.navigateTo({\n    url: '/pages/print/create'\n  })\n}\n\n// 查看详情\nfunction viewDetail(print: PrintRecord) {\n  uni.navigateTo({\n    url: `/pages/print/detail?id=${print._id}`\n  })\n}\n\n// 加载数据\nasync function loadPrints() {\n  try {\n    const db = uniCloud.database()\n    const res = await db.collection('requests')\n      .where({\n        type: 'print'\n      })\n      .orderBy('createTime', 'desc')\n      .get()\n\n    // 转换数据格式\n    const requestData = res.data as any[]\n    prints.value = requestData.map((item: any) => {\n      return {\n        _id: item._id,\n        title: item.title,\n        shopName: item.print?.shop || '',\n        option: getPrintOptionText(item.print?.option),\n        copies: item.print?.copies || 1,\n        amount: calculateAmount(item.print),\n        status: item.status,\n        createTime: item.createTime,\n        fileId: item.print?.fileId || ''\n      } as PrintRecord\n    })\n  } catch (e) {\n    uni.__f__('error','at pages/print/index.vue:183','加载失败:', e)\n    uni.showToast({\n      title: '加载失败',\n      icon: 'none'\n    })\n  }\n}\n\n// 获取打印选项文本\nfunction getPrintOptionText(option: string): string {\n  const optionMap: Record<string, string> = {\n    'mono-single': '黑白单面',\n    'mono-double': '黑白双面',\n    'color-single': '彩色单面',\n    'color-double': '彩色双面'\n  }\n  return optionMap[option] || option\n}\n\n// 计算金额\nfunction calculateAmount(print: any): number {\n  const basePrice = print?.option?.startsWith('color') ? 0.8 : 0.3\n  const duplexFactor = print?.option?.endsWith('double') ? 0.9 : 1\n  return parseFloat(((basePrice * (print?.copies || 1) * duplexFactor).toFixed(2)))\n}\n\nonMounted(() => {\n  loadPrints()\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  padding: 24rpx;\n}\n\n.header-actions {\n  margin-bottom: 24rpx;\n  display: flex;\n  justify-content: flex-end;\n}\n\n.shop-filter {\n  margin-bottom: 32rpx;\n\n  .section-title {\n    display: block;\n    font-size: 28rpx;\n    font-weight: bold;\n    margin-bottom: 16rpx;\n  }\n\n  .picker-display {\n    border: 2rpx solid #000;\n    border-radius: 4rpx;\n    padding: 24rpx;\n    font-size: 28rpx;\n  }\n}\n\n.print-list {\n  .print-card {\n    margin-bottom: 24rpx;\n\n    .print-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 16rpx;\n\n      .print-title {\n        font-size: 32rpx;\n        font-weight: bold;\n        flex: 1;\n      }\n\n      .print-status {\n        padding: 4rpx 12rpx;\n        border-radius: 4rpx;\n        font-size: 24rpx;\n\n        &.status-pending {\n          background-color: #FFF3E0;\n          color: #FF9800;\n        }\n\n        &.status-paid {\n          background-color: #E3F2FD;\n          color: #2196F3;\n        }\n\n        &.status-printing {\n          background-color: #F3E5F5;\n          color: #9C27B0;\n        }\n\n        &.status-completed {\n          background-color: #E8F5E9;\n          color: #4CAF50;\n        }\n\n        &.status-cancelled {\n          background-color: #FFEBEE;\n          color: #F44336;\n        }\n      }\n    }\n\n    .print-info {\n      margin-bottom: 16rpx;\n\n      .info-item {\n        display: block;\n        font-size: 26rpx;\n        color: #666;\n        margin-bottom: 8rpx;\n      }\n    }\n\n    .print-footer {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      font-size: 24rpx;\n      color: #999;\n\n      .print-amount {\n        font-size: 32rpx;\n        font-weight: bold;\n        color: var(--uni-color-primary);\n      }\n    }\n  }\n}\n\n.empty-state {\n  text-align: center;\n  padding: 96rpx 0;\n  color: #999;\n}\n</style>","import MiniProgramPage from 'E:/codeplace/test/pages/print/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["BrutalistCard","BrutalistButton","userStore","useUserStore","prints","ref","selectedShopIndex","printShops","filteredPrints","computed","value","filter","print","shopName","onShopChange","e","detail","formatTime","timestamp","date","Date","diff","getTime","Math","floor","navigateToCreate","isLoggedIn","uni","navigateTo","url","showToast","title","icon","getPrintOptionText","option","calculateAmount","basePrice","_a","startsWith","duplexFactor","_b","endsWith","parseFloat","copies","toFixed","onMounted","async","db","uniCloud","database","requestData","collection","where","type","orderBy","get","data","map","item","_id","shop","_c","amount","status","createTime","fileId","_d","index","__f__","pending","paid","printing","completed","cancelled","wx","createPage","MiniProgramPage"],"mappings":"uGA6DA,MAAAA,EAA0B,IAAA,8CAC1BC,EAA4B,IAAA,6FAetB,MAAAC,EAAYC,EAAAA,eAEZC,EAASC,MAAmB,IAC5BC,EAAoBD,MAAmB,MAGvCE,EAAa,CACjB,QACA,WACA,cACA,eACA,UAIIC,EAAiBC,EAAAA,UAAS,IACE,OAA5BH,EAAkBI,OAA8C,IAA5BJ,EAAkBI,MACjDN,EAAOM,MAETN,EAAOM,MAAMC,QAAOC,GAASA,EAAMC,WAAaN,EAAWD,EAAkBI,WAItF,SAASI,EAAaC,GACFT,EAAAI,MAAQK,EAAEC,OAAON,KACrC,CAeA,SAASO,EAAWC,GACZ,MAAAC,EAAO,IAAIC,KAAKF,GAEhBG,OADUD,MACCE,UAAYH,EAAKG,UAElC,OAAID,EAAO,IACF,KACEA,EAAO,KACTE,KAAKC,MAAMH,EAAO,KAAS,MACzBA,EAAO,MACTE,KAAKC,MAAMH,EAAO,MAAW,MAE7BE,KAAKC,MAAMH,EAAO,OAAY,IAEzC,CAGA,SAASI,IACFvB,EAAUwB,WAQfC,EAAAA,MAAIC,WAAW,CACbC,IAAK,wBARLF,EAAAA,MAAIG,UAAU,CACZC,MAAO,OACPC,KAAM,QAQZ,CA6CA,SAASC,EAAmBC,GAOnB,MANmC,CACxC,cAAe,OACf,cAAe,OACf,eAAgB,OAChB,eAAgB,QAEDA,IAAWA,CAC9B,CAGA,SAASC,EAAgBvB,WACvB,MAAMwB,GAAY,OAAAC,EAAO,MAAAzB,OAAA,EAAAA,EAAAsB,aAAQ,EAAAG,EAAAC,WAAW,UAAW,GAAM,GACvDC,GAAe,OAAAC,EAAO,MAAA5B,OAAA,EAAAA,EAAAsB,aAAQ,EAAAM,EAAAC,SAAS,WAAY,GAAM,EACxD,OAAAC,YAAaN,IAAoB,MAAPxB,OAAO,EAAAA,EAAA+B,SAAU,GAAKJ,GAAcK,QAAQ,GAC/E,QAEAC,EAAAA,WAAU,MApDVC,iBACM,IACI,MAAAC,EAAKC,KAASC,WASdC,SARYH,EAAGI,WAAW,YAC7BC,MAAM,CACLC,KAAM,UAEPC,QAAQ,aAAc,QACtBC,OAGqBC,KACxBpD,EAAOM,MAAQwC,EAAYO,KAAKC,gBACvB,MAAA,CACLC,IAAKD,EAAKC,IACV5B,MAAO2B,EAAK3B,MACZlB,UAAU,OAAAwB,EAAAqB,EAAK9C,YAAL,EAAAyB,EAAYuB,OAAQ,GAC9B1B,OAAQD,EAAmB,OAAAO,EAAKkB,EAAA9C,gBAAOsB,QACvCS,QAAQ,OAAAkB,EAAAH,EAAK9C,YAAL,EAAAiD,EAAYlB,SAAU,EAC9BmB,OAAQ3B,EAAgBuB,EAAK9C,OAC7BmD,OAAQL,EAAKK,OACbC,WAAYN,EAAKM,WACjBC,QAAQ,OAAAC,EAAAR,EAAK9C,YAAL,EAAAsD,EAAYD,SAAU,GAAA,GASpC,OANSlD,GACPY,EAAAwC,MAAIC,MAAM,QAAQ,+BAA+B,QAASrD,GAC1DY,EAAAA,MAAIG,UAAU,CACZC,MAAO,OACPC,KAAM,QAEV,CACF,qKAnFuB+B,WACqB,CACxCM,QAAW,MACXC,KAAQ,MACRC,SAAY,MACZC,UAAa,MACbC,UAAa,OAEEV,IAAWA,yIAoC9B,SAAoBnD,GAClBe,EAAAA,MAAIC,WAAW,CACbC,IAAK,0BAA0BjB,EAAM+C,OAEzC,gCAhDA,IAAuBI,wGCxGvBW,GAAGC,WAAWC"}