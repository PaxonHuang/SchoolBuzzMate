{"version":3,"file":"create.js","sources":["pages/print/create.vue","../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJpbnQvY3JlYXRlLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <brutalist-card>\n      <view class=\"form-group\">\n        <text class=\"label\">‰∏ä‰º†Êñá‰ª∂</text>\n        <view class=\"upload-area\" @click=\"selectFile\">\n          <text class=\"upload-icon\">üìÑ</text>\n          <text>{{ file ? file.name : 'ÁÇπÂáª‰∏ä‰º†ÊñáÊ°£' }}</text>\n          <text class=\"hint\">ÊîØÊåÅPDF/DOCX/JPEGÊ†ºÂºèÔºàÊúÄÂ§ß50MBÔºâ</text>\n        </view>\n      </view>\n\n      <view class=\"form-group\">\n        <text class=\"label\">ÊâìÂç∞Â∫óÈÄâÊã©</text>\n        <picker\n          :range=\"printShops\"\n          :value=\"printShopIndex\"\n          @change=\"onShopChange\"\n        >\n          <view class=\"picker\">\n            {{ printShopIndex !== null ? printShops[printShopIndex] : 'ËØ∑ÈÄâÊã©ÊâìÂç∞Â∫ó' }}\n          </view>\n        </picker>\n      </view>\n\n      <view class=\"form-group\">\n        <text class=\"label\">ÊâìÂç∞ËßÑÊ†º</text>\n        <view class=\"options-grid\">\n          <view\n            v-for=\"option in printOptions\"\n            :key=\"option.value\"\n            class=\"option-card\"\n            :class=\"{ 'selected': formData.printOption === option.value }\"\n            @click=\"formData.printOption = option.value\"\n          >\n            {{ option.label }}\n          </view>\n        </view>\n      </view>\n\n      <view class=\"form-group\">\n        <text class=\"label\">‰ªΩÊï∞</text>\n        <view class=\"quantity-selector\">\n          <text class=\"btn\" @click=\"decreaseQuantity\">-</text>\n          <text class=\"quantity\">{{ formData.copies }}</text>\n          <text class=\"btn\" @click=\"increaseQuantity\">+</text>\n        </view>\n      </view>\n\n      <brutalist-card accent @click=\"submitOrder\">\n        <view class=\"submit-btn\">\n          <text>Êèê‰∫§ËÆ¢ÂçïÔºàÈ¢Ñ‰º∞Ôºö{{ calculatePrice }}ÂÖÉÔºâ</text>\n        </view>\n      </brutalist-card>\n    </brutalist-card>\n  </view>\n</template>\n\n<script setup lang=\"uts\">\nimport { ref, computed } from 'vue';\nimport { useUserStore } from '@/stores/user';\nimport BrutalistCard from '@/components/brutalist/BrutalistCard.vue'\n\ninterface FormData {\n  file?: File;\n  printShop?: string;\n  printOption: 'mono-single' | 'mono-double' | 'color-single' | 'color-double';\n  copies: number;\n}\n\nconst userStore = useUserStore();\nconst file = ref<File | null>(null);\nconst printShopIndex = ref<number | null>(null);\n\nconst printShops = [\n  'Âõæ‰π¶È¶Ü‰∏ÄÊ•ºÊâìÂç∞Â∫ó',\n  'Â≠¶ÁîüÊ¥ªÂä®‰∏≠ÂøÉBÂ∫ßÊâìÂç∞ÁÇπ',\n  '‰∏úÈó®Ê†°Â§ñÊâìÂç∞Â∫óÔºà5ÂàÜÈíüÔºâ',\n  'Ë•øÈó®Âø´Âç∞‰∏≠ÂøÉ'\n];\n\nconst printOptions = [\n  { label: 'ÈªëÁôΩ ÂçïÈù¢', value: 'mono-single' },\n  { label: 'ÈªëÁôΩ ÂèåÈù¢', value: 'mono-double' },\n  { label: 'ÂΩ©Ëâ≤ ÂçïÈù¢', value: 'color-single' },\n  { label: 'ÂΩ©Ëâ≤ ÂèåÈù¢', value: 'color-double' }\n];\n\nconst formData = ref<FormData>({\n  printOption: 'mono-single',\n  copies: 1\n});\n\nconst calculatePrice = computed((): string => {\n  const basePrice = formData.value.printOption.startsWith('color') ? 0.8 : 0.3;\n  const duplexFactor = formData.value.printOption.endsWith('double') ? 0.9 : 1;\n  return (basePrice * formData.value.copies * duplexFactor).toFixed(1);\n});\n\nconst selectFile = () => {\n  uni.chooseFile({\n    count: 1,\n    type: 'file',\n    success: (res) => {\n      if (res.tempFiles && res.tempFiles.length > 0) {\n        file.value = res.tempFiles[0];\n      }\n    }\n  });\n};\n\nconst onShopChange = (e: any) => {\n  printShopIndex.value = e.detail.value;\n};\n\nconst increaseQuantity = () => {\n  if (formData.value.copies < 100) {\n    formData.value.copies++;\n  }\n};\n\nconst decreaseQuantity = () => {\n  if (formData.value.copies > 1) {\n    formData.value.copies--;\n  }\n};\n\nconst submitOrder = async () => {\n  if (!userStore.isLoggedIn) {\n    uni.showToast({ title: 'ËØ∑ÂÖàÁôªÂΩï', icon: 'none' });\n    return;\n  }\n\n  if (!file.value) {\n    uni.showToast({ title: 'ËØ∑‰∏ä‰º†Êñá‰ª∂', icon: 'none' });\n    return;\n  }\n\n  if (printShopIndex.value === null) {\n    uni.showToast({ title: 'ËØ∑ÈÄâÊã©ÊâìÂç∞Â∫ó', icon: 'none' });\n    return;\n  }\n\n  try {\n    // ‰∏ä‰º†Êñá‰ª∂Âà∞‰∫ëÂ≠òÂÇ®\n    const uploadRes = await uniCloud.uploadFile({\n      filePath: file.value.tempFilePath,\n      cloudPath: `prints/${Date.now()}_${file.value.name}`\n    });\n\n    const db = uniCloud.database();\n    const { user } = userStore;\n    const amount = parseFloat(calculatePrice.value);\n\n    // ÂàõÂª∫ÊâìÂç∞ËØ∑Ê±Ç\n    const { _id } = await db.collection('requests').add({\n      type: 'print',\n      title: `ÊâìÂç∞‰ªªÂä° - ${file.value.name}`,\n      description: `${file.value.name} x ${formData.value.copies}‰ªΩ`,\n      tags: [formData.value.printOption],\n      createTime: Date.now(),\n      creator: user._id,\n      status: 'unpaid',\n      print: {\n        fileId: uploadRes.fileID,\n        shop: printShops[printShopIndex.value],\n        option: formData.value.printOption,\n        copies: formData.value.copies\n      }\n    });\n\n\n    // ÂàõÂª∫ËÆ¢ÂçïËÆ∞ÂΩï\n    await db.collection('orders').add({\n      requestId: _id,\n      amount: amount,\n      status: 'unpaid',\n      createTime: Date.now()\n    });\n\n\n    // Ë∑≥ËΩ¨Âà∞ÊîØ‰ªòÈ°µÈù¢\n    uni.navigateTo({\n      url: `/pages/payment/index?orderId=${_id}&amount=${amount}`\n    });\n  } catch (e) {\n    uni.__f__('error','at pages/print/create.vue:187','Êèê‰∫§Â§±Ë¥•:', e);\n    uni.showToast({ title: 'Êèê‰∫§Â§±Ë¥•', icon: 'none' });\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n$black: #000;\n\n.container {\n  padding: 24rpx;\n}\n\n.form-group {\n  margin-bottom: 32rpx;\n\n  .label {\n    display: block;\n    margin-bottom: 16rpx;\n    font-weight: bold;\n    font-size: 28rpx;\n  }\n\n  .picker {\n    border: 2rpx solid $black;\n    padding: 16rpx;\n    border-radius: 4rpx;\n    margin-top: 16rpx;\n  }\n}\n\n.upload-area {\n  border: 2rpx dashed $black;\n  border-radius: 4rpx;\n  padding: 32rpx 0;\n  text-align: center;\n\n  .hint {\n    display: block;\n    margin-top: 8rpx;\n    font-size: 24rpx;\n    color: #666;\n  }\n}\n\n.options-grid {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 16rpx;\n\n  .option-card {\n    border: 2rpx solid $black;\n    border-radius: 4rpx;\n    padding: 16rpx;\n    text-align: center;\n\n    &.selected {\n      background-color: var(--uni-color-primary);\n      color: white;\n    }\n  }\n}\n\n.quantity-selector {\n  display: flex;\n  align-items: center;\n  border: 2rpx solid $black;\n  border-radius: 4rpx;\n  overflow: hidden;\n\n  .btn {\n    flex: 1;\n    padding: 16rpx;\n    text-align: center;\n    background-color: #f5f5f5;\n    border-right: 2rpx solid $black;\n\n\n    &:last-child {\n      border-right: none;\n    }\n  }\n\n  .quantity {\n    flex: 2;\n    padding: 16rpx;\n    text-align: center;\n  }\n}\n\n.submit-btn {\n  display: flex;\n  justify-content: center;\n  padding: 24rpx 0;\n\n  text {\n    font-size: 36rpx;\n    font-weight: bold;\n  }\n}\n</style>","import MiniProgramPage from 'E:/codeplace/test/pages/print/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["BrutalistCard","userStore","useUserStore","file","ref","printShopIndex","printShops","printOptions","label","value","formData","printOption","copies","calculatePrice","computed","basePrice","startsWith","duplexFactor","endsWith","toFixed","selectFile","uni","chooseFile","count","type","success","res","tempFiles","length","onShopChange","e","detail","increaseQuantity","decreaseQuantity","submitOrder","async","isLoggedIn","uploadRes","uniCloud","tr","uploadFile","filePath","tempFilePath","cloudPath","Date","now","name","db","database","user","amount","parseFloat","_id","collection","add","title","description","tags","createTime","creator","status","print","fileId","fileID","shop","option","requestId","navigateTo","url","index","__f__","showToast","icon","wx","createPage","MiniProgramPage"],"mappings":"mGA6DA,MAAAA,EAA0B,IAAA,4FASpB,MAAAC,EAAYC,EAAAA,eACZC,EAAOC,MAAiB,MACxBC,EAAiBD,MAAmB,MAEpCE,EAAa,CACjB,WACA,cACA,eACA,UAGIC,EAAe,CACnB,CAAEC,MAAO,QAASC,MAAO,eACzB,CAAED,MAAO,QAASC,MAAO,eACzB,CAAED,MAAO,QAASC,MAAO,gBACzB,CAAED,MAAO,QAASC,MAAO,iBAGrBC,EAAWN,EAAAA,IAAc,CAC7BO,YAAa,cACbC,OAAQ,IAGJC,EAAiBC,EAAAA,UAAS,KAC9B,MAAMC,EAAYL,EAASD,MAAME,YAAYK,WAAW,SAAW,GAAM,GACnEC,EAAeP,EAASD,MAAME,YAAYO,SAAS,UAAY,GAAM,EAC3E,OAAQH,EAAYL,EAASD,MAAMG,OAASK,GAAcE,QAAQ,EAAC,IAG/DC,EAAa,KACjBC,EAAAA,MAAIC,WAAW,CACbC,MAAO,EACPC,KAAM,OACNC,QAAUC,IACJA,EAAIC,WAAaD,EAAIC,UAAUC,OAAS,IACrCzB,EAAAM,MAAQiB,EAAIC,UAAU,GAC7B,GAEH,EAGGE,EAAgBC,IACLzB,EAAAI,MAAQqB,EAAEC,OAAOtB,KAAA,EAG5BuB,EAAmB,KACnBtB,EAASD,MAAMG,OAAS,KAC1BF,EAASD,MAAMG,QACjB,EAGIqB,EAAmB,KACnBvB,EAASD,MAAMG,OAAS,GAC1BF,EAASD,MAAMG,QACjB,EAGIsB,EAAcC,UACd,GAAClC,EAAUmC,WAKX,GAACjC,EAAKM,MAKN,GAAyB,OAAzBJ,EAAeI,MAKf,IAEI,MAAA4B,QAAkBC,EAAAC,GAASC,WAAW,CAC1CC,SAAUtC,EAAKM,MAAMiC,aACrBC,UAAW,UAAUC,KAAKC,SAAS1C,EAAKM,MAAMqC,SAG1CC,EAAKT,KAASU,YACdC,KAAEA,GAAShD,EACXiD,EAASC,WAAWtC,EAAeJ,QAGnC2C,IAAEA,SAAcL,EAAGM,WAAW,YAAYC,IAAI,CAClD9B,KAAM,QACN+B,MAAO,UAAUpD,EAAKM,MAAMqC,OAC5BU,YAAa,GAAGrD,EAAKM,MAAMqC,UAAUpC,EAASD,MAAMG,UACpD6C,KAAM,CAAC/C,EAASD,MAAME,aACtB+C,WAAYd,KAAKC,MACjBc,QAASV,EAAKG,IACdQ,OAAQ,SACRC,MAAO,CACLC,OAAQzB,EAAU0B,OAClBC,KAAM1D,EAAWD,EAAeI,OAChCwD,OAAQvD,EAASD,MAAME,YACvBC,OAAQF,EAASD,MAAMG,gBAMrBmC,EAAGM,WAAW,UAAUC,IAAI,CAChCY,UAAWd,EACXF,SACAU,OAAQ,SACRF,WAAYd,KAAKC,QAKnBxB,EAAAA,MAAI8C,WAAW,CACbC,IAAK,gCAAgChB,YAAcF,KAKvD,OAHSpB,GACPT,EAAAgD,MAAIC,MAAM,QAAQ,gCAAgC,QAASxC,GAC3DT,EAAAgD,MAAIE,UAAU,CAAEhB,MAAO,OAAQiB,KAAM,QACvC,MAjDEnD,EAAAgD,MAAIE,UAAU,CAAEhB,MAAO,SAAUiB,KAAM,cALvCnD,EAAAgD,MAAIE,UAAU,CAAEhB,MAAO,QAASiB,KAAM,cALtCnD,EAAAgD,MAAIE,UAAU,CAAEhB,MAAO,OAAQiB,KAAM,QA2DvC,mZC3LFC,GAAGC,WAAWC"}