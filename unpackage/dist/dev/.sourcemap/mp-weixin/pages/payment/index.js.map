{"version":3,"file":"index.js","sources":["pages/payment/index.vue","../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGF5bWVudC9pbmRleC52dWU"],"sourcesContent":["<template>\n  <brutalist-card class=\"payment-container\">\n    <view class=\"payment-header\">\n      <text class=\"title\">ËÆ¢ÂçïÊîØ‰ªò</text>\n      <text class=\"amount\">¬•{{ amount }}</text>\n    </view>\n\n    <brutalist-card>\n      <view class=\"payment-method\">\n        <text class=\"payment-icon\">üí≥</text>\n        <text>ÂæÆ‰ø°ÊîØ‰ªò</text>\n      </view>\n    </brutalist-card>\n\n    <brutalist-card accent @click=\"handlePayment\">\n      <view class=\"submit-btn\">\n        <text>Á´ãÂç≥ÊîØ‰ªò</text>\n      </view>\n    </brutalist-card>\n  </brutalist-card>\n</template>\n\n<script setup lang=\"uts\">\nimport { ref } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app';\nimport BrutalistCard from '@/components/brutalist/BrutalistCard.vue'\n\nconst orderId = ref<string>('');\nconst amount = ref<number>(0);\n\nonLoad((options: any) => {\n  orderId.value = options.orderId;\n  amount.value = parseFloat(options.amount);\n});\n\nconst handlePayment = async () => {\n  try {\n    // 1. Ë∞ÉÁî®‰∫ëÂáΩÊï∞Ëé∑ÂèñÊîØ‰ªòÂèÇÊï∞\n    const paymentRes = await uniCloud.callFunction({\n      name: 'createPayment',\n      data: { orderId: orderId.value }\n    });\n\n    if (paymentRes.result.code !== 200) {\n      uni.showToast({\n        title: paymentRes.result.message || 'ÊîØ‰ªòÂèÇÊï∞Ëé∑ÂèñÂ§±Ë¥•',\n        icon: 'none'\n      });\n      return;\n    }\n\n    const { paymentParams } = paymentRes.result.data;\n\n    // 2. ÂèëËµ∑ÂæÆ‰ø°ÊîØ‰ªò\n    await uni.requestPayment({\n      ...paymentParams,\n      success: async () => {\n        // 3. ÊîØ‰ªòÊàêÂäüÔºåÊõ¥Êñ∞ËÆ¢ÂçïÁä∂ÊÄÅ\n        await uniCloud.database().collection('orders').doc(orderId.value).update({\n          status: 'paid',\n          paymentTime: Date.now()\n        });\n\n        uni.showToast({ title: 'ÊîØ‰ªòÊàêÂäü' });\n        setTimeout(() => {\n          uni.navigateBack();\n        }, 1500);\n      },\n      fail: (err) => {\n        uni.__f__('error','at pages/payment/index.vue:70','ÊîØ‰ªòÂ§±Ë¥•:', err);\n        uni.showToast({\n          title: 'ÊîØ‰ªòÂèñÊ∂àÊàñÂ§±Ë¥•',\n          icon: 'none'\n        });\n      }\n    });\n  } catch (e) {\n    uni.__f__('error','at pages/payment/index.vue:78','ÊîØ‰ªòÂ§ÑÁêÜÂ§±Ë¥•:', e);\n    uni.showToast({\n      title: 'ÊîØ‰ªòÂ§ÑÁêÜÂ§±Ë¥•',\n      icon: 'none'\n    });\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n$black: #000;\n\n.payment-container {\n  padding: 48rpx 24rpx;\n\n  .payment-header {\n    text-align: center;\n    margin-bottom: 48rpx;\n\n    .title {\n      font-size: 36rpx;\n      font-weight: bold;\n      display: block;\n      margin-bottom: 16rpx;\n    }\n\n    .amount {\n      font-size: 64rpx;\n      font-weight: bold;\n      color: var(--uni-color-primary);\n    }\n  }\n\n  .payment-method {\n    display: flex;\n    align-items: center;\n    gap: 24rpx;\n    padding: 24rpx;\n    border: 2rpx solid $black;\n    border-radius: 4rpx;\n\n    text {\n      font-size: 32rpx;\n    }\n  }\n\n  .submit-btn {\n    display: flex;\n    justify-content: center;\n    padding: 24rpx 0;\n\n\n    text {\n      font-size: 36rpx;\n      font-weight: bold;\n    }\n  }\n}\n</style>","import MiniProgramPage from 'E:/codeplace/test/pages/payment/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["BrutalistCard","orderId","ref","amount","common_vendor","onLoad","options","value","parseFloat","handlePayment","async","paymentRes","uniCloud","tr","callFunction","name","data","result","code","uni","showToast","title","message","icon","paymentParams","requestPayment","success","database","collection","doc","update","status","paymentTime","Date","now","setTimeout","index","navigateBack","fail","err","__f__","e","wx","createPage","MiniProgramPage"],"mappings":"iEAyBA,MAAAA,EAA0B,IAAA,2FAEpB,MAAAC,EAAUC,MAAY,IACtBC,EAASD,MAAY,GAE3BE,EAAAC,QAAQC,IACNL,EAAQM,MAAQD,EAAQL,QACjBE,EAAAI,MAAQC,WAAWF,EAAQH,OAAM,IAG1C,MAAMM,EAAgBC,UAChB,IAEI,MAAAC,QAAmBC,EAAAC,GAASC,aAAa,CAC7CC,KAAM,gBACNC,KAAM,CAAEf,QAASA,EAAQM,SAGvB,GAA2B,MAA3BI,EAAWM,OAAOC,KAKpB,YAJAC,EAAAA,MAAIC,UAAU,CACZC,MAAOV,EAAWM,OAAOK,SAAW,WACpCC,KAAM,SAKV,MAAMC,cAAEA,GAAkBb,EAAWM,OAAOD,WAGtCG,EAAAA,MAAIM,eAAe,IACpBD,EACHE,QAAShB,gBAEDE,EAAAC,GAASc,WAAWC,WAAW,UAAUC,IAAI5B,EAAQM,OAAOuB,OAAO,CACvEC,OAAQ,OACRC,YAAaC,KAAKC,QAGpBf,EAAAA,MAAIC,UAAU,CAAEC,MAAO,SACvBc,YAAW,KACThB,EAAAiB,MAAIC,cAAa,GAChB,KAAI,EAETC,KAAOC,IACLpB,EAAAiB,MAAII,MAAM,QAAQ,gCAAgC,QAASD,GAC3DpB,EAAAA,MAAIC,UAAU,CACZC,MAAO,UACPE,KAAM,QACP,GASP,OANSkB,GACPtB,EAAAiB,MAAII,MAAM,QAAQ,gCAAgC,UAAWC,GAC7DtB,EAAAA,MAAIC,UAAU,CACZC,MAAO,SACPE,KAAM,QAEV,uHCjFFmB,GAAGC,WAAWC"}