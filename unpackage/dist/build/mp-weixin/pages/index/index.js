"use strict";const t=require("../../common/vendor.js"),e={data:()=>({postList:[],loading:!0,loadingMore:!1,isEnd:!1,currentPage:1,pageSize:10}),onLoad(){this.checkLoginStatus(),this.loadPosts()},onPullDownRefresh(){this.refreshData()},onReachBottom(){this.loadMore()},methods:{checkLoginStatus:()=>!!t.index.getStorageSync("token")||(t.index.redirectTo({url:"/pages/login/login"}),!1),async loadPosts(e=!1){e&&(this.currentPage=1,this.isEnd=!1);try{const o=t.index.getStorageSync("token"),s=await t.tr.callFunction({name:"get-posts",data:{token:o,page:this.currentPage,pageSize:this.pageSize}});if(0===s.result.code){const{posts:t,total:o,totalPages:i}=s.result.data;this.postList=e?t:[...this.postList,...t],this.currentPage>=i&&(this.isEnd=!0)}else t.index.showToast({title:s.result.message||"åŠ è½½å¤±è´¥",icon:"none"})}catch(o){console.error("åŠ è½½åŠ¨æ€å¤±è´¥:",o),t.index.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"})}finally{this.loading=!1,this.loadingMore=!1,e&&t.index.stopPullDownRefresh()}},refreshData(){this.loadPosts(!0)},loadMore(){this.loadingMore||this.isEnd||(this.loadingMore=!0,this.currentPage++,this.loadPosts())},async likePost(e,o,s){if(this.checkLoginStatus())try{const o=t.index.getStorageSync("token"),i=await t.tr.callFunction({name:"like-post",data:{token:o,postId:e}});if(0===i.result.code){const{isLiked:t,likes:e}=i.result.data;this.postList[s].isLiked=t,this.postList[s].likes=e}else t.index.showToast({title:i.result.message||"æ“ä½œå¤±è´¥",icon:"none"})}catch(i){console.error("ç‚¹èµå¤±è´¥:",i),t.index.showToast({title:"æ“ä½œå¤±è´¥",icon:"none"})}},commentPost(e){t.index.navigateTo({url:`/pages/comments/comments?postId=${e}`})},sharePost(e){t.index.showToast({title:"åˆ†äº«åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},goToUserProfile(e){t.index.showToast({title:"ç”¨æˆ·ä¸»é¡µå¼€å‘ä¸­",icon:"none"})},previewImage(e,o=0){t.index.previewImage({current:o,urls:e})},formatTime(t){const e=new Date,o=new Date(t),s=e-o;return s<6e4?"åˆšåˆš":s<36e5?Math.floor(s/6e4)+"åˆ†é’Ÿå‰":s<864e5?Math.floor(s/36e5)+"å°æ—¶å‰":s<2592e6?Math.floor(s/864e5)+"å¤©å‰":`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${o.getDate().toString().padStart(2,"0")}`},goToPost(){t.index.navigateTo({url:"/pages/post/post"})},goToProfile(){t.index.navigateTo({url:"/pages/profile/profile"})}}};if(!Array){(t.resolveComponent("BrutalistTitle")+t.resolveComponent("BrutalistLoading")+t.resolveComponent("BrutalistAvatar")+t.resolveComponent("BrutalistCard")+t.resolveComponent("BrutalistButton"))()}Math||((()=>"../../components/BrutalistTitle/BrutalistTitle.js")+(()=>"../../components/BrutalistLoading/BrutalistLoading.js")+(()=>"../../components/BrutalistAvatar/BrutalistAvatar.js")+(()=>"../../components/BrutalistCard/BrutalistCard.js")+(()=>"../../components/BrutalistButton/BrutalistButton.js"))();const o=t._export_sfc(e,[["render",function(e,o,s,i,n,a){return t.e({a:t.p({title:"æ ¡å›­åŠ¨æ€",size:"large",rotate:.5}),b:n.loading},n.loading?{c:t.p({text:"åŠ è½½ä¸­..."})}:n.postList.length>0?{e:t.f(n.postList,(e,o,s)=>t.e({a:"79030325-3-"+s+",79030325-2-"+s,b:t.p({src:e.userInfo.avatar,text:e.userInfo.nickname,size:"medium"}),c:t.t(e.userInfo.nickname),d:e.userInfo.school},e.userInfo.school?{e:t.t(e.userInfo.school)}:{},{f:t.t(a.formatTime(e.createTime)),g:t.o(t=>a.goToUserProfile(e.userId),e._id),h:e.content},e.content?{i:t.t(e.content)}:{},{j:e.images&&e.images.length},e.images&&e.images.length?{k:t.f(e.images,(o,s,i)=>({a:o,b:s,c:t.o(t=>a.previewImage(e.images,s),s)}))}:{},{l:t.t(e.isLiked?"â¤ï¸":"ğŸ¤"),m:t.t(e.likes||0),n:t.o(t=>a.likePost(e._id,e.isLiked,o),e._id),o:t.t(e.comments||0),p:t.o(t=>a.commentPost(e._id),e._id),q:t.o(t=>a.sharePost(e._id),e._id),r:"79030325-2-"+s,s:t.p({rotate:o%2==0?-.5:.5}),t:e._id}))}:{f:t.o(a.goToPost),g:t.p({text:"å»å‘å¸ƒ",type:"primary"}),h:t.p({rotate:-1})},{d:n.postList.length>0,i:n.postList.length>0&&!n.isEnd},n.postList.length>0&&!n.isEnd?{j:t.o(a.loadMore),k:t.p({text:"åŠ è½½æ›´å¤š",type:"secondary",loading:n.loadingMore})}:{},{l:n.isEnd&&n.postList.length>0},(n.isEnd&&n.postList.length,{}))}]]);wx.createPage(o);
