# 校园社交系统开发技能

## 技术栈概述

- **前端框架**: UniAPP (Vue3 + TypeScript)
- **后端服务**: UniCloud (阿里云版)
- **数据库**: UniCloud DB (MongoDB)
- **云存储**: UniCloud Storage (图片存储)
- **认证服务**: UniCloud Auth + 微信小程序登录
- **UI组件库**: uView UI
- **状态管理**: Pinia
- **HTTP请求**: UniCloud客户端SDK

## 核心功能模块

### 1. 认证系统
- 微信登录授权
- 手机号绑定验证
- 用户会话管理
- 用户信息存储

### 2. 动态发布系统
- 图文内容编辑
- 多图片上传处理
- 内容审核机制
- 发布权限控制

### 3. 信息流展示
- 时间轴布局
- 分页加载实现
- 下拉刷新功能
- 内容缓存策略

### 4. 互动功能
- 点赞/取消点赞
- 评论发布与回复
- 通知消息系统
- 用户关注系统

### 5. 个人中心
- 用户资料管理
- 我的动态列表
- 设置项配置
- 隐私控制

## UI设计规范

### 粗野主义手绘风格 (Brutalist Hand-drawn)

#### 基础样式
- **边框**: 4rpx 粗黑边框
- **阴影**: 6rpx 6rpx 0px 阴影效果
- **旋转**: 手绘感不规则旋转 (rotate(-1deg))
- **对比度**: 强烈的黑白对比

#### 色彩方案
```css
:root {
  --color-primary: #000000;     /* 主色：黑色 */
  --color-accent: #FF6B6B;      /* 强调色：红色 */
  --color-highlight: #FFE66D;   /* 亮色：黄色 */
  --color-background: #FFFFFF;  /* 背景：白色 */
  --color-text: #333333;        /* 文字：深灰 */
}
```

#### 字体层级
```css
.font-heading {
  font-size: 48rpx;
  font-weight: 900;
}

.font-button {
  font-size: 32rpx;
  font-weight: 700;
}

.font-body {
  font-size: 30rpx;
  font-weight: 400;
}
```

#### 通用组件样式
```css
/* 粗野主义卡片 */
.brutalist-card {
  border: 4rpx solid var(--color-primary);
  box-shadow: 6rpx 6rpx 0px rgba(0, 0, 0, 0.8);
  transform: rotate(-1deg);
  background-color: var(--color-background);
  padding: 24rpx;
  margin: 16rpx;
}

/* 粗野主义按钮 */
.brutalist-button {
  border: 4rpx solid var(--color-primary);
  box-shadow: 6rpx 6rpx 0px rgba(0, 0, 0, 0.8);
  transform: rotate(-1deg);
  transition: all 0.2s ease;
}

.brutalist-button:active {
  transform: rotate(0deg) translate(3rpx, 3rpx);
  box-shadow: 3rpx 3rpx 0px rgba(0, 0, 0, 0.8);
}

/* 手绘风格输入框 */
.brutalist-input {
  border: 4rpx solid var(--color-primary);
  box-shadow: 6rpx 6rpx 0px rgba(0, 0, 0, 0.8);
  transform: rotate(-1deg);
  background-color: var(--color-background);
}
```

## 页面布局规范

### 1. 登录页面
- 顶部品牌标识 (粗野主义风格)
- 中间微信登录按钮
- 底部手机号绑定表单
- 用户协议链接

### 2. 首页动态流
- 顶部搜索栏和分类标签
- 动态卡片列表 (粗野主义卡片)
- 底部导航栏
- 下拉刷新动画

### 3. 发布动态页
- 顶部文字输入区域
- 中间图片上传区域
- 底部发布按钮
- 表情选择器

### 4. 动态详情页
- 顶部返回栏和分享按钮
- 动态内容展示
- 点赞评论互动区
- 评论输入框

### 5. 个人中心页
- 用户信息头部
- 功能入口列表
- 我的动态预览
- 设置选项

## UniCloud云函数开发

### 通用云函数模板
```javascript
'use strict';
const db = uniCloud.database();
exports.main = async (event, context) => {
  // 1. 参数验证
  // 2. 身份验证
  // 3. 业务逻辑处理
  // 4. 数据库操作
  // 5. 返回结果
};
```

### 认证相关云函数
- `user-login`: 微信登录处理
- `bind-phone`: 手机号绑定
- `get-user-info`: 获取用户信息
- `update-profile`: 更新用户资料

### 动态相关云函数
- `publish-post`: 发布动态
- `get-posts`: 获取动态列表
- `like-post`: 点赞/取消点赞
- `add-comment`: 添加评论

## 数据库设计

### 用户表 (users)
```javascript
{
  _id: String,
  openid: String,
  unionid: String,
  nickname: String,
  avatar: String,
  phone: String,
  gender: Number,
  bio: String,
  school: String,
  major: String,
  grade: String,
  create_time: Date,
  update_time: Date
}
```

### 动态表 (posts)
```javascript
{
  _id: String,
  user_id: String,
  content: String,
  images: Array,
  likes_count: Number,
  comments_count: Number,
  create_time: Date,
  update_time: Date
}
```

### 评论表 (comments)
```javascript
{
  _id: String,
  post_id: String,
  user_id: String,
  content: String,
  reply_to: String,
  create_time: Date
}
```

### 点赞表 (likes)
```javascript
{
  _id: String,
  user_id: String,
  target_id: String,  // 动态或评论ID
  type: String,      // 'post' 或 'comment'
  create_time: Date
}
```

## 前端开发最佳实践

### 1. 组件开发规范
- 使用 `<script setup lang="ts">` 语法
- 组件名使用 PascalCase
- Props 定义必须指定类型
- 使用 Composition API

### 2. 状态管理规范
- 使用 Pinia 进行状态管理
- 模块化设计 Store
- 异步操作使用 Actions
- 使用 TypeScript 定义类型

### 3. 网络请求规范
- 统一使用 UniCloud 客户端 SDK
- 封装常用请求方法
- 统一错误处理
- 请求/响应拦截器

### 4. 页面生命周期规范
- 遵循 UniAPP 生命周期钩子
- 页面卸载时清理资源
- 使用 `onLoad` 接收参数
- 使用 `onShow` 刷新数据

## 常用工具函数

### 1. 格式化时间
```javascript
export const formatTime = (time: Date | string) => {
  const date = new Date(time);
  const now = new Date();
  const diff = now.getTime() - date.getTime();
  
  if (diff < 60000) return '刚刚';
  if (diff < 3600000) return `${Math.floor(diff / 60000)}分钟前`;
  if (diff < 86400000) return `${Math.floor(diff / 3600000)}小时前`;
  if (diff < 604800000) return `${Math.floor(diff / 86400000)}天前`;
  
  return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
};
```

### 2. 图片上传处理
```javascript
export const uploadImage = async (filePath: string) => {
  try {
    const result = await uniCloud.uploadFile({
      filePath,
      cloudPath: `posts/${Date.now()}-${Math.floor(Math.random() * 1000)}.jpg`
    });
    return result.fileID;
  } catch (error) {
    console.error('图片上传失败:', error);
    throw error;
  }
};
```

### 3. 微信授权登录
```javascript
export const wxLogin = async () => {
  try {
    // 获取微信登录凭证
    const loginRes = await uni.login();
    if (!loginRes.code) {
      throw new Error('微信登录失败');
    }
    
    // 调用云函数进行登录处理
    const result = await uniCloud.callFunction({
      name: 'user-login',
      data: { code: loginRes.code }
    });
    
    return result;
  } catch (error) {
    console.error('登录过程出错:', error);
    throw error;
  }
};
```

## 性能优化建议

### 1. 图片处理
- 使用图片压缩
- 实现图片懒加载
- 根据网络环境加载不同质量图片

### 2. 列表优化
- 使用虚拟列表处理长列表
- 分页加载减少一次性加载量
- 实现列表项复用

### 3. 缓存策略
- 使用本地缓存存储常用数据
- 实现请求结果缓存
- 合理设置缓存过期时间

## 测试规范

### 1. 单元测试
- 云函数核心逻辑测试
- 工具函数测试
- 组件逻辑测试

### 2. 集成测试
- 完整业务流程测试
- 数据流测试
- 接口调用测试

### 3. 用户测试
- 界面交互测试
- 异常情况处理
- 性能表现测试

## 部署与发布

### 1. 云函数部署
```bash
# 部署所有云函数
uniCloud deploy

# 部署单个云函数
uniCloud deploy -f user-login
```

### 2. 小程序发布
1. 开发者工具上传代码
2. 微信公众平台提交审核
3. 审核通过后发布上线

### 3. 版本管理
- 使用 Git 进行代码版本控制
- 规范提交信息格式
- 定期打 tag 标记重要版本