# 微信小程序 WebSocket 连接问题 - 完整解决方案

## ⚠️ 重要提示

**WebSocket 错误不会影响小程序的功能！**

这个错误只是影响热重载（自动刷新）功能。修改代码后，你需要**手动点击微信开发者工具的"编译"按钮**来查看更改。

---

## 问题原因

UniAppX 使用 WebSocket 实现热重载（HMR），但在微信开发者工具中连接失败。这是 UniAppX 与微信开发者工具之间的已知兼容性问题。

---

## ✅ 推荐解决方案

### 方案 1：使用手动编译（推荐用于开发）

**这是最稳定的方式：**

1. 在 HBuilderX 中编写代码
2. 保存文件
3. 在微信开发者工具中点击"编译"按钮
4. 查看更改效果

**优点：**
- 最稳定，不会出现连接错误
- 代码改动立即生效
- 适合日常开发

---

### 方案 2：使用生产模式测试（推荐用于最终测试）

```bash
npm run build:mp-weixin
```

然后在微信开发者工具中打开 `unpackage/dist/build/mp-weixin` 目录。

**优点：**
- 完全模拟生产环境
- 没有 WebSocket 错误
- 性能更好

---

### 方案 3：清除缓存重试

如果你仍然想使用热重载，可以尝试：

1. **运行清除脚本**
   ```bash
   清除缓存并重新编译.bat
   ```

2. **或手动清除**
   - 删除 `unpackage` 目录
   - 删除 `node_modules\.vite` 目录

3. **重新编译**
   - 在 HBuilderX 中重新运行到微信开发者工具

---

## 🔧 微信开发者工具设置

即使有 WebSocket 错误，也请确保以下设置正确：

### 本地设置
- ✅ 不校验合法域名
- ✅ 不启用 ES6 转 ES5
- ❌ 关闭增强编译
- ❌ 关闭使用 npm 模块

### 调试基础库
- 版本：2.30.0 或更高

---

## 📝 常见问题

### Q: 为什么会出现这个错误？
A: UniAppX 的热重载服务器尝试通过 WebSocket 连接微信开发者工具，但连接被拒绝或超时。

### Q: 这个错误会影响小程序功能吗？
A: **不会！** 只是热重载不工作，手动编译即可。

### Q: 如何查看代码更改？
A: 在微信开发者工具中点击"编译"按钮，或使用快捷键 Ctrl+B。

### Q: 什么时候需要关心这个错误？
A: 只有当你需要自动刷新功能时才需要解决。否则可以忽略。

---

## 🎯 最佳实践

1. **开发阶段**：使用手动编译（方案 1）
2. **测试阶段**：使用生产模式（方案 2）
3. **发布前**：使用生产模式测试（方案 2）

---

## 📞 需要帮助？

如果问题持续存在：

1. 确保微信开发者工具是最新版本
2. 确保 HBuilderX 是最新版本
3. 检查是否有防火墙或代理阻止连接
4. 尝试更换网络环境

---

## 🎉 总结

**WebSocket 错误可以安全忽略！**

- ✅ 小程序功能完全正常
- ✅ 手动编译即可查看更改
- ✅ 生产模式没有任何问题

专注于开发，不要被这个错误打扰！

